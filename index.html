<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>SK â€“ Há»‡ thá»‘ng Kiá»ƒm tra Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js cho Dashboard -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --primary:#2563eb;
      --primary-soft:#dbeafe;
      --primary-strong:#1d4ed8;
      --danger:#dc2626;
      --danger-soft:#fee2e2;
      --muted:#6b7280;
      --bg-card:#0b1220;
      --bg-elevated:#020617;
      --border-soft:#1e293b;
      --radius-lg:18px;
    }
    *{
      box-sizing:border-box;
      -webkit-tap-highlight-color:transparent;
    }
    body{
      font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#e0edff,#f9fafb);
      min-height:100vh;
      padding:16px 10px 24px;
      color:#111827;
      font-size:16px;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:12px;
    }
    header h1{
      margin:0;
      font-size:1.15rem;
      font-weight:700;
      letter-spacing:.02em;
      text-transform:uppercase;
      color:#0f172a;
    }
    header p{
      margin:4px 0 0;
      font-size:.9rem;
      color:var(--muted);
    }
    .badge-top{
      margin-top:6px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px;
      border-radius:999px;
      background:#0f172a;
      color:#e5e7eb;
      font-size:.75rem;
    }
    .badge-top span.dot{
      width:7px;height:7px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#38bdf8,#0ea5e9);
      box-shadow:0 0 10px #38bdf8;
    }
    header .avatar-chip{
      min-width:72px;
      max-width:120px;
      background:#020617;
      color:#e5e7eb;
      border-radius:999px;
      padding:6px 10px;
      display:flex;
      align-items:center;
      gap:7px;
      box-shadow:0 14px 40px rgba(15,23,42,.55);
    }
    .avatar-circle{
      width:26px;height:26px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#38bdf8,#4f46e5);
      display:flex;align-items:center;justify-content:center;
      font-size:1rem;
    }
    .avatar-chip span.label{
      font-size:.76rem;
      line-height:1.2;
    }
    nav{
      margin-bottom:14px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    nav button{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:.86rem;
      font-weight:500;
      cursor:pointer;
      background:#ffffffb8;
      color:#374151;
      box-shadow:0 8px 22px rgba(15,23,42,.12);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    nav button.active{
      background:linear-gradient(135deg,#2563eb,#4f46e5);
      color:#fff;
      box-shadow:0 12px 30px rgba(37,99,235,.55);
    }
    nav button span.icon{font-size:1rem;}

    main{
      display:block;
    }
    section.page{
      display:none;
      background:radial-gradient(circle at top,#020617,#020617 55%,#030712);
      border-radius:var(--radius-lg);
      padding:14px 14px 16px;
      box-shadow:0 22px 60px rgba(15,23,42,.85);
      color:#e5e7eb;
      border:1px solid #1f2937;
    }
    section.page.active{
      display:block;
    }
    .section-title{
      font-size:1.02rem;
      margin:0 0 4px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .section-title span.badge-inline{
      font-size:.7rem;
      text-transform:uppercase;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(37,99,235,.14);
      border:1px solid rgba(37,99,235,.5);
      color:#bfdbfe;
    }
    .section-desc{
      margin:0 0 10px;
      font-size:.84rem;
      color:#9ca3af;
    }
    .section-desc b{color:#e5e7eb;}

    .grid-2{
      display:grid;
      grid-template-columns:1.1fr 1.1fr;
      gap:10px 14px;
    }
    @media(max-width:768px){
      .grid-2{
        grid-template-columns:1fr;
      }
      header{
        flex-direction:column;
      }
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    label{
      font-size:.9rem;
      font-weight:600;
      color:#111827;
    }
    input,select,textarea{
      border-radius:10px;
      border:1px solid #d1d5db;
      padding:10px 11px;
      font-size:1rem;
      outline:none;
      width:100%;
    }
        .dob-group{
      display:flex;
      gap:6px;
    }
    .dob-group select{
      flex:1;
    }
input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,.35);
    }
    textarea{min-height:60px;resize:vertical;}

    .hint{
      font-size:.75rem;
      color:#9ca3af;
    }
    .row{
      display:flex;
      gap:8px;
    }
    .row > .field{flex:1;}

    .alert{
      margin-top:10px;
      padding:8px 10px;
      border-radius:10px;
      font-size:.78rem;
      line-height:1.4;
    }
    .alert.info{
      background:rgba(37,99,235,.1);
      border:1px solid rgba(37,99,235,.6);
      color:#bfdbfe;
    }
    .alert.warn{
      background:rgba(202,138,4,.1);
      border:1px solid rgba(234,179,8,.7);
      color:#facc15;
    }
    .alert.error{
      background:rgba(248,113,113,.1);
      border:1px solid rgba(220,38,38,.7);
      color:#fecaca;
    }

    .btn-row{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn-primary,.btn-ghost{
      border-radius:999px;
      border:none;
      padding:8px 14px;
      font-size:.88rem;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      letter-spacing:.02em;
    }
    .btn-primary{
      background:linear-gradient(135deg,#2563eb,#4f46e5);
      color:#fff;
      box-shadow:0 14px 40px rgba(37,99,235,.7);
    }
    .btn-ghost{
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      border:1px solid #374151;
    }

    .pill-warning{
      font-size:.77rem;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(234,179,8,.08);
      border:1px dashed rgba(234,179,8,.9);
      color:#fde68a;
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:6px;
    }

    /* LOGIN & EXAM */
    .card{
      background:radial-gradient(circle at top,#020617,#020617 55%,#030712);
      border-radius:16px;
      border:1px solid #111827;
      padding:12px 12px 14px;
      box-shadow:0 20px 50px rgba(15,23,42,.85);
      margin-top:4px;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:8px;
    }
    .card-title{
      margin:0;
      font-size:.96rem;
    }
    .card-sub{
      margin:2px 0 0;
      font-size:.8rem;
      color:#9ca3af;
    }
    .tag{
      font-size:.7rem;
      border-radius:999px;
      padding:2px 7px;
      border:1px solid rgba(148,163,184,.7);
      color:#e5e7eb;
      background:rgba(15,23,42,.9);
    }
    .timer{
      font-variant-numeric:tabular-nums;
      font-size:1.1rem;
      font-weight:700;
      color:#fbbf24;
    }

    /* DASHBOARD */
    .dashboard-grid{
      display:grid;
      grid-template-columns:1.1fr 1.2fr;
      gap:10px;
      margin-top:6px;
    }
    @media(max-width:900px){
      .dashboard-grid{
        grid-template-columns:1fr;
      }
    }
    .stat-box{
      background:#020617;
      border-radius:16px;
      padding:10px 10px 11px;
      border:1px solid #1f2937;
      box-shadow:0 18px 45px rgba(15,23,42,.9);
    }
    .stat-box h3{
      margin:0 0 6px;
      font-size:.9rem;
    }
    .stat-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:4px;
      font-size:.8rem;
    }
    .stat-row span.label{
      color:#9ca3af;
    }
    .stat-row span.value{
      font-weight:600;
      color:#e5e7eb;
    }
    .chart-card{
      background:#f9fafb;
      border-radius:16px;
      padding:10px 10px 12px;
      box-shadow:0 16px 40px rgba(15,23,42,.12) inset;
      display:flex;
      flex-direction:column;
      min-height:210px;
    }
    .chart-card h3{
      font-size:.9rem;margin-bottom:3px;
    }
    .chart-card p{
      font-size:.78rem;color:var(--muted);margin-bottom:8px;
    }
    .chart-wrapper{flex:1;min-height:160px;}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 7px;
      border-radius:999px;
      background:var(--primary-soft);
      color:var(--primary);
      font-size:.75rem;
      margin-top:3px;
    }
    .badge span.dot{
      width:7px;height:7px;border-radius:999px;background:var(--primary);
    }

    /* TRA Cá»¨U */
    #results{
      margin-top:12px;
      font-size:.82rem;
    }
    .result-card{
      background:#020617;
      border-radius:12px;
      border:1px solid #1f2937;
      padding:8px 10px;
      margin-bottom:6px;
    }
    .result-card h4{
      margin:0 0 2px;font-size:.9rem;
    }
    .result-meta{
      display:flex;flex-wrap:wrap;gap:6px;
      font-size:.78rem;color:#9ca3af;
    }
    .status-msg{
      margin-top:8px;
      font-size:.82rem;
    }
    .status-error{color:#fecaca;}
    .status-empty{color:#9ca3af;}

  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>SK â€“ Há»‡ thá»‘ng Kiá»ƒm tra Online</h1>
      <p>ÄÄƒng kÃ½ â€“ LÃ m bÃ i â€“ Xem Dashboard â€“ Tra cá»©u káº¿t quáº£ trÃªn cÃ¹ng má»™t trang.</p>
      <div class="badge-top"><span class="dot"></span><span>PhiÃªn báº£n PREMIUM</span></div>
    </div>
    <div class="avatar-chip">
      <div class="avatar-circle">AI</div>
      <span class="label">DTAI Online<br/>NDC â€“ LÃ¢m Äá»“ng</span>
    </div>
  </header>

  <nav>
    <button class="active" onclick="show('reg', this)"><span class="icon">ğŸ“</span>ÄÄƒng kÃ½</button>
    <button onclick="show('login', this)"><span class="icon">ğŸ”</span>ÄÄƒng nháº­p</button>
    <button onclick="show('exam', this)"><span class="icon">ğŸ§ª</span>VÃ o thi</button>
    <button onclick="show('review', this)"><span class="icon">ğŸ“„</span>Xem láº¡i</button>
    <button onclick="show('dash', this)"><span class="icon">ğŸ“Š</span>Dashboard</button>
    <button onclick="show('search', this)"><span class="icon">ğŸ”</span>Xem káº¿t quáº£</button>

  <!-- cÃ¡c nÃºt cÅ© -->
  <button onclick="show('reg', this)" class="active"><span class="icon">ğŸ“</span>ÄÄƒng kÃ½</button>
  <button onclick="show('login', this)"><span class="icon">ğŸ”</span>ÄÄƒng nháº­p</button>
  <button onclick="show('exam', this)"><span class="icon">ğŸ§ª</span>VÃ o thi</button>
  <button onclick="show('review', this)"><span class="icon">ğŸ“„</span>Xem láº¡i</button>
  <button onclick="show('dash', this)"><span class="icon">ğŸ“Š</span>Dashboard</button>
  <button onclick="show('search', this)"><span class="icon">ğŸ”</span>Xem káº¿t quáº£</button>

  <!-- ğŸ‘‰ THÃŠM Má»šI: Import Ä‘á» -->
  <button onclick="show('import', this)"><span class="icon">ğŸ“¥</span>Import Ä‘á» Word</button>
    
  </nav>

  <main>
    <!-- 1. ÄÄ‚NG KÃ -->
    <section id="reg" class="page active">
      <h2 class="section-title">ÄÄƒng kÃ½ tham gia há»‡ thá»‘ng <span class="badge-inline">Student Registration</span></h2>
      <p class="section-desc">Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin bÃªn dÆ°á»›i. Há»‡ thá»‘ng tá»± kiá»ƒm tra trÃ¹ng <b>CCCD</b> hoáº·c <b>Email</b> trÆ°á»›c khi lÆ°u.</p>

      <!-- ğŸ‘‰ THAY URL WEB APP Táº I ÄÃ‚Y -->
      <form id="regForm"
            method="post"
            action="https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec">
        <div class="grid-2">
          <div class="field">
            <label for="hoten">Há» vÃ  tÃªn (IN HOA)</label>
            <input id="hoten" name="hoten" placeholder="VD: NGUYá»„N VÄ‚N A" required />
            <div class="hint">Nháº­p thÆ°á»ng cÅ©ng Ä‘Æ°á»£c, há»‡ thá»‘ng sáº½ tá»± Ä‘á»•i thÃ nh IN HOA khi lÆ°u.</div>
          </div>
          <div class="field">
            <label for="dob-day">NgÃ y sinh</label>
            <div class="dob-group">
              <select id="dob-day" aria-label="NgÃ y sinh - ngÃ y"></select>
              <select id="dob-month" aria-label="NgÃ y sinh - thÃ¡ng"></select>
              <select id="dob-year" aria-label="NgÃ y sinh - nÄƒm"></select>
              <input type="hidden" id="ngaysinh" name="ngaysinh" />
            </div>
            <div class="hint">Chá»n láº§n lÆ°á»£t NgÃ y â€“ ThÃ¡ng â€“ NÄƒm. Há»‡ thá»‘ng sáº½ tá»± ghÃ©p thÃ nh dd/mm/yyyy.</div>
          </div>
          <div class="field">
            <label for="gioitinh">Giá»›i tÃ­nh</label>
            <select id="gioitinh" name="gioitinh">
              <option value="">-- Chá»n --</option>
              <option>Nam</option>
              <option>Ná»¯</option>
              <option>KhÃ¡c</option>
            </select>
          </div>
          <div class="field">
            <label for="dantoc">DÃ¢n tá»™c</label>
            <select id="dantoc" name="dantoc">
              <option>Kinh</option>
              <option>CÆ¡-ho</option>
              <option>Ba-na</option>
              <option>KhÃ¡c</option>
            </select>
          </div>
          <div class="field">
            <label for="truong">TrÆ°á»ng</label>
            <select id="truong" name="truong">
              <option>THPT Nguyá»…n ÄÃ¬nh Chiá»ƒu</option>
              <option>THPT Pháº¡m VÄƒn Äá»“ng</option>
              <option>THPT Báº£o Lá»™c</option>
              <option>THPT Äá»©c Trá»ng</option>
              <option>TrÆ°á»ng khÃ¡c (ghi chÃº)</option>
            </select>
            <div class="hint">Náº¿u trÆ°á»ng chÆ°a cÃ³ trong danh sÃ¡ch, chá»n â€œTrÆ°á»ng khÃ¡c (ghi chÃº)â€ vÃ  ghi rÃµ á»Ÿ Ã´ Ghi chÃº.</div>
          </div>
          <div class="field">
            <label for="xa">XÃ£/PhÆ°á»ng</label>
            <input id="xa" name="xa" placeholder="VD: XÃ£ Kiáº¿n Äá»©c" />
          </div>
          <div class="field">
            <label for="tinh">Tá»‰nh/TP</label>
            <select id="tinh" name="tinh">
              <option>LÃ¢m Äá»“ng</option>
              <option>Äáº¯k Láº¯k</option>
              <option>Äáº¯k NÃ´ng</option>
              <option>TP. Há»“ ChÃ­ Minh</option>
              <option>HÃ  Ná»™i</option>
              <option value="KhÃ¡c">Tá»‰nh/TP khÃ¡c</option>
            </select>
          </div>
          <div class="field">
            <label for="khoi">Khá»‘i</label>
            <select id="khoi" name="khoi" required>
              <option value="">-- Chá»n khá»‘i --</option>
              <option>10</option>
              <option>11</option>
              <option>12</option>
            </select>
          </div>
          <div class="field">
            <label for="malop">Lá»›p</label>
            <input id="malop" name="malop" placeholder="VD: 12A1" />
            <div class="hint">Nháº­p Ä‘Ãºng Ä‘á»‹nh dáº¡ng: 10A1, 11A2, 12A5,â€¦</div>
          </div>
          <div class="field">
            <label for="cccd">CCCD</label>
            <input id="cccd" name="cccd" inputmode="numeric" placeholder="Chá»‰ nháº­p sá»‘" />
            <div class="hint">Há»‡ thá»‘ng lÆ°u CCCD dáº¡ng kÃ½ tá»± sá»‘ (chuá»—i), khÃ´ng tÃ­nh toÃ¡n trÃªn trÆ°á»ng nÃ y.</div>
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="VD: ten@gmail.com" />
            <div class="hint">DÃ¹ng Ä‘á»ƒ há»‡ thá»‘ng gá»­i xÃ¡c nháº­n Ä‘Äƒng kÃ½ & thÃ´ng tin phÃ²ng thi.</div>
          </div>
          <div class="field">
            <label for="ghichu">Ghi chÃº thÃªm</label>
            <textarea id="ghichu" name="ghichu" placeholder="VD: TrÆ°á»ng khÃ¡c, hoÃ n cáº£nh Ä‘áº·c biá»‡t, ..."></textarea>
          </div>
        </div>

        <div class="alert warn">
          âš  <b>LÆ°u Ã½ thá»i gian:</b> Tháº§y/cÃ´ cÃ³ thá»ƒ cáº¥u hÃ¬nh ca thi giá»›i háº¡n giá» trÃªn há»‡ thá»‘ng. Há»c sinh nÃªn hoÃ n thÃ nh Ä‘Äƒng kÃ½ sá»›m Ä‘á»ƒ trÃ¡nh ngháº½n.
        </div>

        <div class="btn-row">
          <button type="submit" class="btn-primary">
            <span>Gá»­i Ä‘Äƒng kÃ½ / Submit</span>
          </button>
          <button type="reset" class="btn-ghost">
            XÃ³a dá»¯ liá»‡u / Reset
          </button>
        </div>
      </form>
    </section>

    <!-- 2. ÄÄ‚NG NHáº¬P -->
    <section id="login" class="page">
      <h2 class="section-title">ÄÄƒng nháº­p báº±ng CCCD + máº­t kháº©u</h2>
      <p class="section-desc">Má»—i há»c sinh sá»­ dá»¥ng <b>01 CCCD</b> vÃ  máº­t kháº©u riÃªng (Ä‘Æ°á»£c gá»­i qua email sau khi Ä‘Äƒng kÃ½ thÃ nh cÃ´ng).</p>

      <div class="card">
        <div class="card-header">
          <div>
            <h3 class="card-title">ThÃ´ng tin Ä‘Äƒng nháº­p</h3>
            <p class="card-sub">Nháº­p Ä‘Ãºng CCCD & máº­t kháº©u Ä‘á»ƒ vÃ o khu vá»±c lÃ m bÃ i / xem káº¿t quáº£.</p>
          </div>
          <span class="tag">SECURE LOGIN</span>
        </div>

        <form id="loginForm">
          <div class="grid-2">
            <div class="field">
              <label for="login-cccd">CCCD</label>
              <input id="login-cccd" name="login-cccd" placeholder="Nháº­p CCCD Ä‘Ã£ Ä‘Äƒng kÃ½" inputmode="numeric" />
            </div>
            <div class="field">
              <label for="login-pass">Máº­t kháº©u</label>
              <input id="login-pass" name="login-pass" type="password" placeholder="Máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c gá»­i qua email" />
            </div>
          </div>

          <div class="pill-warning">
            â± Gá»£i Ã½: ÄÄƒng nháº­p trÆ°á»›c giá» thi Ã­t nháº¥t 5 phÃºt Ä‘á»ƒ kiá»ƒm tra káº¿t ná»‘i & thÃ´ng tin cÃ¡ nhÃ¢n.
          </div>

          <div class="btn-row">
            <button type="submit" class="btn-primary">
              <span>ÄÄƒng nháº­p / Login</span>
            </button>
            <button type="button" class="btn-ghost" onclick="alert('LiÃªn há»‡ GVCN hoáº·c BGH Ä‘á»ƒ cáº¥p láº¡i máº­t kháº©u.')">
              QuÃªn máº­t kháº©u?
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- 3. VÃ€O THI -->
    <section id="exam" class="page">
      <h2 class="section-title">VÃ o thi trá»±c tuyáº¿n <span class="badge-inline">Online Exam</span></h2>
      <p class="section-desc">Sau khi Ä‘Äƒng nháº­p, há»‡ thá»‘ng sáº½ tá»± gá»£i Ã½ mÃ£ ca thi, Ä‘á»“ng há»“ Ä‘áº¿m ngÆ°á»£c & link Ä‘á» tÆ°Æ¡ng á»©ng.</p>

      <div class="card">
        <div class="card-header">
          <div>
            <h3 class="card-title">ThÃ´ng tin ca thi / Exam slot</h3>
            <p class="card-sub">Dá»±a trÃªn mÃ£ ca thi mÃ  tháº§y/cÃ´ Ä‘Ã£ cáº¥u hÃ¬nh trÆ°á»›c trong Google Sheet.</p>
          </div>
          <div style="text-align:right;">
            <div class="timer" id="examTimer">--:--</div>
            <div style="font-size:.7rem;color:#9ca3af;">Thá»i gian cÃ²n láº¡i / Time left</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="exam-code">MÃ£ ca thi</label>
            <input id="exam-code" placeholder="VD: 11A3-TKTx-TOAN-CA1" />
          </div>
          <div class="field">
            <label for="examLink">Link Ä‘á» (Google Form/Quiz)</label>
            <input id="examLink" placeholder="DÃ¡n link Ä‘á» náº¿u muá»‘n má»Ÿ thá»§ cÃ´ng" />
          </div>
        </div>

        <div class="alert info">
          â° VÃ­ dá»¥ cáº£nh bÃ¡o: <b>â€œÄáº¿n 08:45 há»‡ thá»‘ng sáº½ khÃ´ng nháº­n bÃ i ná»¯a. HÃ£y báº¥m Gá»¬I trÆ°á»›c thá»i Ä‘iá»ƒm nÃ y.â€</b><br/>
          ThÃ´ng Ä‘iá»‡p nÃ y cÃ³ thá»ƒ sinh tá»± Ä‘á»™ng dá»±a vÃ o cáº¥u hÃ¬nh ca thi trong Sheet <code>CauHinhThi</code>.
        </div>

        <div class="btn-row">
          <button type="button" class="btn-primary" onclick="openExam()">
            <span>VÃ o thi / Start exam</span>
          </button>
          <button type="button" class="btn-ghost" onclick="openSheet()">
            Xem cáº¥u hÃ¬nh ca thi (Sheet)
          </button>
        </div>
      </div>
    </section>

    <!-- 4. XEM Láº I -->
    <section id="review" class="page">
      <h2 class="section-title">Xem láº¡i thÃ´ng tin cÃ¡ nhÃ¢n / Káº¿t quáº£ gáº§n Ä‘Ã¢y</h2>
      <p class="section-desc">TÃ­nh nÄƒng nÃ y sáº½ Ä‘á»c tá»« Sheet Ä‘iá»ƒm & Ä‘Äƒng kÃ½ Ä‘á»ƒ hiá»ƒn thá»‹ láº¡i lá»‹ch sá»­ lÃ m bÃ i cá»§a tá»«ng há»c sinh.</p>

      <div class="alert info">
        ğŸ§© Pháº§n nÃ y dÃ¹ng chung endpoint <code>mode=search</code> hoáº·c <code>mode=results</code> (JSONP) trong Code.gs Ä‘á»ƒ láº¥y dá»¯ liá»‡u lá»‹ch sá»­.
      </div>
    </section>

    <!-- 5. DASHBOARD -->
    <section id="dash" class="page">
      <h2 class="section-title">Dashboard tá»•ng há»£p <span class="badge-inline">Overview</span></h2>
      <p class="section-desc">Dá»¯ liá»‡u láº¥y tá»« sheet <b>DangKy</b> vÃ  sheet <b>DiemThi</b> Ä‘á»ƒ thá»‘ng kÃª theo khá»‘i, lá»›p, giá»›i tÃ­nh, dÃ¢n tá»™c, trÆ°á»ng.</p>

      <div class="dashboard-grid">
        <div class="stat-box">
          <h3>Thá»‘ng kÃª Ä‘Äƒng kÃ½ / Registrations</h3>
          <div id="statTotal" class="stat-row">
            <span class="label">Tá»•ng sá»‘ Ä‘Ã£ Ä‘Äƒng kÃ½</span>
            <span class="value">â€¦</span>
          </div>
          <div id="statKhoi" class="stat-row">
            <span class="label">Theo khá»‘i (10/11/12)</span>
            <span class="value">â€¦</span>
          </div>
          <div id="statGioiTinh" class="stat-row">
            <span class="label">Theo giá»›i tÃ­nh</span>
            <span class="value">â€¦</span>
          </div>
          <div id="statEthnic" class="stat-row">
            <span class="label">Theo dÃ¢n tá»™c</span>
            <span class="value">â€¦</span>
          </div>
          <div id="statSchool" class="stat-row">
            <span class="label">Theo trÆ°á»ng</span>
            <span class="value">â€¦</span>
          </div>
        </div>

        <div class="chart-card">
          <h3>Biá»ƒu Ä‘á»“ phÃ¢n bá»‘ theo khá»‘i / Grade distribution</h3>
          <p>GiÃºp BGH náº¯m nhanh sá»‘ lÆ°á»£ng há»c sinh Ä‘Äƒng kÃ½ theo tá»«ng khá»‘i lá»›p.</p>
          <div class="chart-wrapper">
            <canvas id="chartKhoi"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- 6. TRA Cá»¨U Káº¾T QUáº¢ -->
    <section id="search" class="page">
      <h2 class="section-title">Tra cá»©u káº¿t quáº£ / Result lookup</h2>
      <p class="section-desc">Nháº­p CCCD hoáº·c Há» tÃªn + Lá»›p Ä‘á»ƒ xem láº¡i Ä‘iá»ƒm tá»« sheet <b>DiemThi</b>.</p>

      <form id="searchForm">
        <div class="grid-2">
          <div class="field">
            <label for="search-cccd">CCCD</label>
            <input id="search-cccd" placeholder="Æ¯u tiÃªn tra cá»©u theo CCCD" inputmode="numeric" />
          </div>
          <div class="field">
            <label for="search-name">Há» tÃªn (IN HOA)</label>
            <input id="search-name" placeholder="VD: NGUYá»„N VÄ‚N A" />
          </div>
          <div class="field">
            <label for="search-class">Lá»›p</label>
            <input id="search-class" placeholder="VD: 12A1" />
          </div>
        </div>

        <div class="btn-row">
          <button type="submit" class="btn-primary">
            <span class="icon">ğŸ”</span><span>Tra cá»©u káº¿t quáº£</span>
          </button>
        </div>
      </form>
      <div id="status" class="status-msg status-empty"></div>
      <div id="results" class="results"></div>
    </section>
  </main>
</div>

<script>
  // ğŸ‘‰ NHá»š Cáº¬P NHáº¬T CÃ™NG Má»˜T URL Vá»šI action Cá»¦A FORM
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec";

  function show(id, btn){
    document.querySelectorAll("section.page").forEach(sec=>{
      sec.classList.toggle("active", sec.id === id);
    });
    if(btn){
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
    }
  }

  function openExam(){
    const link = document.getElementById("examLink").value.trim();
    if(!link){ alert("Tháº§y/chá»‹ nháº­p link Google Form/Quiz trÆ°á»›c Ä‘Ã£ nhÃ©."); return; }
    window.open(link,"_blank");
  }
  function openSheet(){
    alert("Má»Ÿ sheet CauHinhThi trÃªn Google Sheets (tháº§y cáº¥u hÃ¬nh link riÃªng).");
  }

  // JSONP helper
  function callJsonp(url, cbName){
    return new Promise((resolve, reject)=>{
      const callbackName = "jsonp_cb_" + Date.now();
      window[callbackName] = function(data){
        resolve(data);
        delete window[callbackName];
        script.remove();
      };
      const script = document.createElement("script");
      script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + callbackName;
      script.onerror = reject;
      document.body.appendChild(script);
    });
  }

  // Dashboard
  async function loadDashboard(){
    try{
      const url = WEB_APP_URL + "?mode=stats";
      const data = await callJsonp(url,"statsCallback");
      if(!data) return;

      document.querySelector("#statTotal .value").textContent = data.total || 0;

      if(data.byKhoi){
        const entries = Object.entries(data.byKhoi);
        document.querySelector("#statKhoi .value").textContent =
          entries.map(([k,v])=>k+": "+v).join(" Â· ") || "â€”";
        const ctx = document.getElementById("chartKhoi");
        if(ctx){
          new Chart(ctx,{
            type:"bar",
            data:{
              labels:entries.map(e=>e[0]),
              datasets:[{
                label:"Sá»‘ HS",
                data:entries.map(e=>e[1])
              }]
            },
            options:{
              plugins:{legend:{display:false}},
              scales:{
                x:{ticks:{font:{size:11}}},
                y:{beginAtZero:true,ticks:{stepSize:1}}
              }
            }
          });
        }
      }

      if(data.byGender){
        document.querySelector("#statGioiTinh .value").textContent =
          Object.entries(data.byGender).map(([k,v])=>k+": "+v).join(" Â· ") || "â€”";
      }
      if(data.byEthnicity){
        document.querySelector("#statEthnic .value").textContent =
          Object.entries(data.byEthnicity).map(([k,v])=>k+": "+v).join(" Â· ") || "â€”";
      }
      if(data.bySchool){
        document.querySelector("#statSchool .value").textContent =
          Object.entries(data.bySchool).map(([k,v])=>k+": "+v).join(" Â· ") || "â€”";
      }
    }catch(err){
      console.error("Lá»—i load Dashboard:",err);
    }
  }

  function buildSearchUrl(){
    const cccd = document.getElementById("search-cccd").value.trim();
    const name = document.getElementById("search-name").value.trim().toUpperCase();
    const className = document.getElementById("search-class").value.trim().toUpperCase();

    const params = new URLSearchParams();
    params.set("mode","search");
    if(cccd) params.set("cccd", cccd);
    if(name) params.set("name", name);
    if(className) params.set("className", className);

    return WEB_APP_URL + "?" + params.toString();
  }

  function renderSearchResults(data){
    const statusEl = document.getElementById("status");
    const resultsEl= document.getElementById("results");
    resultsEl.innerHTML="";
    if(!data){
      statusEl.textContent = "KhÃ´ng cÃ³ dá»¯ liá»‡u tráº£ vá».";
      statusEl.className = "status-msg status-error";
      return;
    }
    if(!data.found){
      statusEl.textContent = data.message || "KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£ phÃ¹ há»£p.";
      statusEl.className = "status-msg status-empty";
      return;
    }
    statusEl.textContent = data.message || "";
    statusEl.className = "status-msg";
    (data.results || []).forEach(row=>{
      const div = document.createElement("div");
      div.className = "result-card";
      div.innerHTML = `
        <h4>${row.name || ""} â€“ ${row.className || ""}</h4>
        <div class="result-meta">
          <span>Äiá»ƒm: <b>${row.score ?? ""}</b></span>
          <span>CCCD: ${row.cccd || "â€”"}</span>
          <span>Giá»›i tÃ­nh: ${row.gender || "â€”"}</span>
          <span>DÃ¢n tá»™c: ${row.ethnic || "â€”"}</span>
          <span>TrÆ°á»ng: ${row.school || "â€”"}</span>
        </div>
      `;
      resultsEl.appendChild(div);
    });
  }

  document.getElementById("searchForm").addEventListener("submit",async function(e){
    e.preventDefault();
    const statusEl = document.getElementById("status");
    const resultsEl= document.getElementById("results");
    resultsEl.innerHTML="";
    statusEl.textContent = "Äang tra cá»©u, vui lÃ²ng chá»â€¦";
    statusEl.className = "status-msg status-empty";

    try{
      const url = buildSearchUrl();
      const data = await callJsonp(url,"searchCallback");
      renderSearchResults(data);
    }catch(err){
      console.error(err);
      statusEl.textContent = "CÃ³ lá»—i khi tra cá»©u. Tháº§y/cÃ´ kiá»ƒm tra láº¡i Code.gs hoáº·c káº¿t ná»‘i máº¡ng.";
      statusEl.className = "status-msg status-error";
    }
  });

  // Khá»Ÿi táº¡o select NgÃ y sinh (NgÃ y-ThÃ¡ng-NÄƒm) cho mobile
  function setupNgaySinh(){
    const daySel = document.getElementById("dob-day");
    const monthSel = document.getElementById("dob-month");
    const yearSel = document.getElementById("dob-year");
    const hidden = document.getElementById("ngaysinh");
    if(!daySel || !monthSel || !yearSel || !hidden) return;

    // Táº¡o option NgÃ y
    daySel.innerHTML = '<option value="">NgÃ y</option>';
    for(let d=1; d<=31; d++){
      const opt = document.createElement("option");
      opt.value = String(d).padStart(2,"0");
      opt.textContent = d;
      daySel.appendChild(opt);
    }

    // ThÃ¡ng
    monthSel.innerHTML = '<option value="">ThÃ¡ng</option>';
    for(let m=1; m<=12; m++){
      const opt = document.createElement("option");
      opt.value = String(m).padStart(2,"0");
      opt.textContent = m;
      monthSel.appendChild(opt);
    }

    // NÄƒm (1980â€“2015)
    yearSel.innerHTML = '<option value="">NÄƒm</option>';
    for(let y=2015; y>=1980; y--){
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = y;
      yearSel.appendChild(opt);
    }

    function syncDob(){
      const d = daySel.value;
      const m = monthSel.value;
      const y = yearSel.value;
      if(d && m && y){
        hidden.value = d + "/" + m + "/" + y;
      }else{
        hidden.value = "";
      }
    }

    daySel.addEventListener("change", syncDob);
    monthSel.addEventListener("change", syncDob);
    yearSel.addEventListener("change", syncDob);

    // TrÆ°á»›c khi submit form Ä‘Äƒng kÃ½, Ä‘áº£m báº£o Ä‘Ã£ sync
    const regForm = document.getElementById("regForm");
    if(regForm){
      regForm.addEventListener("submit", function(){
        syncDob();
      }, {capture:true});
    }
  }

  // Táº£i Dashboard + khá»Ÿi táº¡o Date of Birth khi trang load
  // Táº£i Dashboard ngay sau khi trang load (cÃ³ sáºµn dá»¯ liá»‡u cho tab Dashboard)
  document.addEventListener("DOMContentLoaded", function(){
    loadDashboard();
    setupNgaySinh();
  });
</script>
</body>
</html>
