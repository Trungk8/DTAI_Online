<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary:#2563eb;
      --primary-soft:#dbeafe;
      --primary-dark:#1d4ed8;
      --accent:#f97316;
      --bg:#f3f4f6;
      --text:#111827;
      --muted:#6b7280;
      --card-radius:18px;
      --shadow-big:0 18px 45px rgba(15,23,42,.16);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#e0f2fe,#f9fafb);
      color:var(--text);
    }
    .wrap{
      max-width:960px;
      margin:24px auto 40px;
      padding:0 16px;
    }
    h1{
      margin:0 0 8px;
      font-size:1.5rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h1 span.logo-dot{
      width:26px;height:26px;
      border-radius:999px;
      background:conic-gradient(from 220deg,var(--primary),#10b981,#6366f1);
      box-shadow:0 0 0 3px #eff6ff;
    }
    nav{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }
    nav button{
      flex:1 1 120px;
      border:none;
      border-radius:999px;
      padding:8px 14px;
      background:#fff;
      color:var(--muted);
      font-weight:600;
      box-shadow:0 8px 20px rgba(15,23,42,.08);
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      gap:6px;
      font-size:.9rem;
      transition:.18s all ease;
    }
    nav button.active{
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      color:#fff;
      box-shadow:0 10px 26px rgba(37,99,235,.5);
      transform:translateY(-1px);
    }

    section.card{
      margin-top:24px;
      background:#fff;
      border-radius:var(--card-radius);
      box-shadow:var(--shadow-big);
      padding:20px 18px;
    }
    @media(min-width:720px){
      section.card{padding:24px 22px;}
    }
    .card h2{
      margin-top:0;
      font-size:1.25rem;
      margin-bottom:10px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .card h2 span.icon{font-size:1.4rem;}

    /* FORM ƒêƒÇNG K√ù */
    form{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:8px;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:12px;
    }
    .col-12{grid-column:span 12;}
    .col-6{grid-column:span 12;}
    .col-4{grid-column:span 12;}
    @media(min-width:720px){
      .col-6{grid-column:span 6;}
      .col-4{grid-column:span 4;}
    }
    label{
      display:block;
      font-size:.85rem;
      font-weight:600;
      margin-bottom:4px;
      color:var(--text);
    }
    label span.en{
      font-weight:500;
      color:var(--muted);
      font-size:.8rem;
    }
    input, select, textarea{
      width:100%;
      border-radius:999px;
      border:1px solid #e5e7eb;
      padding:9px 12px;
      font-size:.9rem;
      outline:none;
      background:#f9fafb;
      transition:.16s all ease;
    }
    textarea{
      min-height:80px;
      border-radius:12px;
      resize:vertical;
    }
    input:focus, select:focus, textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,.35);
      background:#fff;
    }
    .hint{
      font-size:.78rem;
      color:var(--muted);
      margin-top:2px;
    }
    .flex{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btn-primary{
      margin-top:6px;
      border:none;
      border-radius:999px;
      padding:9px 18px;
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      color:#fff;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 12px 26px rgba(37,99,235,.5);
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:.9rem;
    }
    .btn-primary span.icon{font-size:1.1rem;}
    .btn-ghost{
      border-radius:999px;
      padding:7px 12px;
      border:1px dashed #d1d5db;
      background:#f9fafb;
      font-size:.78rem;
      color:var(--muted);
    }

    /* QR */
    .qr-wrap{
      margin-top:16px;
      text-align:center;
    }
    .qr-wrap img{
      width:180px;
      max-width:60%;
      border-radius:24px;
      box-shadow:0 18px 45px rgba(15,23,42,.18);
      background:#fff;
      padding:12px;
    }

    /* V√ÄO THI */
    .exam-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:10px;
    }
    .exam-card{
      background:linear-gradient(135deg,#eef2ff,#eff6ff);
      border-radius:16px;
      padding:12px 12px 13px;
      position:relative;
      overflow:hidden;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      border-radius:999px;
      padding:2px 8px;
      font-size:.75rem;
      background:rgba(37,99,235,.08);
      color:var(--primary-dark);
      font-weight:600;
      gap:4px;
    }
    .exam-card h3{
      margin:6px 0 4px;
      font-size:1rem;
    }
    .exam-card p{
      margin:0;
      font-size:.82rem;
      color:var(--muted);
    }
    .pill-btn{
      margin-top:8px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:7px 12px;
      border-radius:999px;
      border:none;
      background:var(--primary);
      color:#fff;
      font-size:.8rem;
      font-weight:600;
      text-decoration:none;
      box-shadow:0 10px 22px rgba(37,99,235,.5);
    }

    /* DASHBOARD */
    .stat-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:8px;
    }
    .stat-card{
      flex:1 1 140px;
      background:#f9fafb;
      border-radius:14px;
      padding:10px 12px;
      border:1px solid #e5e7eb;
    }
    .stat-card h4{
      margin:0 0 2px;
      font-size:.85rem;
    }
    .stat-card .big{
      font-size:1.3rem;
      font-weight:700;
      color:var(--primary-dark);
    }
    .table-wrapper{
      margin-top:12px;
      max-height:260px;
      overflow:auto;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#f9fafb;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:.8rem;
    }
    th,td{
      padding:6px 8px;
      border-bottom:1px solid #e5e7eb;
      text-align:left;
      white-space:nowrap;
    }
    th{
      position:sticky;
      top:0;
      background:#e5e7eb;
      z-index:1;
    }
    tr:nth-child(even) td{background:#fdfdfd;}

    .badge-khoi{
      display:inline-block;
      border-radius:999px;
      padding:1px 8px;
      font-size:.75rem;
      background:#eff6ff;
      color:var(--primary-dark);
      font-weight:600;
    }
    .muted{color:var(--muted);font-size:.8rem;}

    .hidden{display:none;}
  </style>
</head>
<body>
<div class="wrap">
  <h1>
    <span class="logo-dot"></span>
    SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online
  </h1>
  <div class="muted" style="margin-bottom:8px;">
    T·ªëi ∆∞u cho ƒëi·ªán tho·∫°i ¬∑ Form s√°ng ‚Äì d·ªÖ nh√¨n ¬∑ T·ª± ƒë·ªông IN HOA h·ªç t√™n ¬∑ Ch·ªëng ƒëƒÉng k√Ω tr√πng CCCD &amp; Email
  </div>

  <nav>
    <button id="btn-reg"   class="active" onclick="show('reg')">üìù ƒêƒÉng k√Ω</button>
    <button id="btn-exam"  onclick="show('exam')">‚ñ∂Ô∏è V√†o thi</button>
    <button id="btn-review"onclick="show('review')">üìä Dashboard</button>
  </nav>

  <!-- ƒêƒÇNG K√ù -->
  <section id="reg" class="card">
    <h2><span class="icon">üìù</span>ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
    <div class="muted">ƒêi·ªÅn th√¥ng tin c·∫©n th·∫≠n. C√°c tr∆∞·ªùng ƒë·ªÅu c√≥ g·ª£i √Ω ƒë·ªÉ nh·∫≠p nhanh tr√™n ƒëi·ªán tho·∫°i.</div>

    <form id="registerForm"
          action="https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec"
          method="POST">

      <div class="grid">
        <!-- H·ªå T√äN -->
        <div class="col-12">
          <label for="hoten">H·ªç v√† t√™n <span class="en">/ Full name</span></label>
          <input id="hoten" name="hoten" type="text" required
                 placeholder="VD: Nguy·ªÖn VƒÉn Trung"
                 autocomplete="name">
          <div class="hint">Nh·∫≠p ƒë√∫ng ch√≠nh t·∫£. H·ªá th·ªëng s·∫Ω t·ª± chuy·ªÉn th√†nh CH·ªÆ IN HOA khi l∆∞u.</div>
        </div>

        <!-- NG√ÄY SINH + GI·ªöI T√çNH -->
        <div class="col-6">
          <label for="ngaysinh">Ng√†y sinh <span class="en">/ Date of birth</span></label>
          <input id="ngaysinh" name="ngaysinh" type="date" required>
          <div class="hint">Ch·ªçn tr√™n l·ªãch cho nhanh, chu·∫©n ƒë·ªãnh d·∫°ng.</div>
        </div>
        <div class="col-6">
          <label for="gioitinh">Gi·ªõi t√≠nh <span class="en">/ Gender</span></label>
          <select id="gioitinh" name="gioitinh" required>
            <option value="">-- Ch·ªçn --</option>
            <option value="Nam">Nam</option>
            <option value="N·ªØ">N·ªØ</option>
            <option value="Kh√°c">Kh√°c</option>
          </select>
        </div>

        <!-- D√ÇN T·ªòC -->
        <div class="col-6">
          <label for="dantoc">D√¢n t·ªôc <span class="en">/ Ethnicity</span></label>
          <select id="dantoc" name="dantoc" required>
            <option value="">-- Ch·ªçn d√¢n t·ªôc --</option>
            <option value="Kinh">Kinh</option>
            <option value="M·∫°">M·∫°</option>
            <option value="K'Ho">K'Ho</option>
            <option value="N√πng">N√πng</option>
            <option value="T√†y">T√†y</option>
            <option value="Kh√°c">Kh√°c...</option>
          </select>
          <div class="hint">N·∫øu kh√¥ng c√≥ trong danh s√°ch, h√£y ch·ªçn <b>Kh√°c...</b> v√† ghi r√µ trong Ghi ch√∫.</div>
        </div>

        <!-- TR∆Ø·ªúNG -->
        <div class="col-6">
          <label for="truong">Tr∆∞·ªùng <span class="en">/ School</span></label>
          <select id="truong" name="truong">
            <option value="THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu">THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu</option>
            <option value="THPT Ph·∫°m VƒÉn ƒê·ªìng">THPT Ph·∫°m VƒÉn ƒê·ªìng</option>
            <option value="THPT DTNT">THPT DTNT</option>
            <option value="">Kh√°c...</option>
          </select>
          <input id="truong_khac" name="truong_khac" type="text" class="hidden"
                 placeholder="Nh·∫≠p t√™n tr∆∞·ªùng kh√°c...">
          <div class="hint">N·∫øu ch·ªçn m·ª•c <b>Kh√°c...</b>, h√£y nh·∫≠p t√™n tr∆∞·ªùng ·ªü √¥ b√™n d∆∞·ªõi.</div>
        </div>

        <!-- X√É / PH∆Ø·ªúNG -->
        <div class="col-6">
          <label for="xa">X√£ / Ph∆∞·ªùng <span class="en">/ Ward</span></label>
          <select id="xa" name="xa">
            <option value="">-- Ch·ªçn / nh·∫≠p --</option>
            <option value="Ph∆∞·ªùng 1">Ph∆∞·ªùng 1</option>
            <option value="Ph∆∞·ªùng 2">Ph∆∞·ªùng 2</option>
            <option value="Ph∆∞·ªùng 3">Ph∆∞·ªùng 3</option>
            <option value="X√£ ...">Kh√°c (nh·∫≠p ·ªü ghi ch√∫)</option>
          </select>
        </div>

        <!-- T·ªàNH -->
        <div class="col-6">
          <label for="tinh">T·ªânh / TP <span class="en">/ Province</span></label>
          <select id="tinh" name="tinh">
            <option value="L√¢m ƒê·ªìng">L√¢m ƒê·ªìng</option>
            <option value="ƒê·∫Øk N√¥ng">ƒê·∫Øk N√¥ng</option>
            <option value="">Kh√°c...</option>
          </select>
          <input id="tinh_khac" name="tinh_khac" type="text" class="hidden"
                 placeholder="Nh·∫≠p t·ªânh/th√†nh kh√°c...">
        </div>

        <!-- KH·ªêI -->
        <div class="col-4">
          <label for="khoi">Kh·ªëi <span class="en">/ Grade</span></label>
          <select id="khoi" name="khoi" required>
            <option value="">-- Ch·ªçn --</option>
            <option value="10">Kh·ªëi 10</option>
            <option value="11">Kh·ªëi 11</option>
            <option value="12">Kh·ªëi 12</option>
          </select>
        </div>

        <!-- L·ªöP -->
        <div class="col-4">
          <label for="lopPreset">L·ªõp (ch·ªçn nhanh) <span class="en">/ Class preset</span></label>
          <select id="lopPreset">
            <option value="">-- Ch·ªçn --</option>
            <option value="10A1">10A1</option>
            <option value="10A2">10A2</option>
            <option value="11A1">11A1</option>
            <option value="12A1">12A1</option>
          </select>
          <div class="hint">Ch·ªçn m·∫´u n·∫øu tr√πng v·ªõi l·ªõp c·ªßa em.</div>
        </div>
        <div class="col-4">
          <label for="malop">L·ªõp (t√πy √Ω) <span class="en">/ Class manual</span></label>
          <input id="malop" name="malop" type="text" placeholder="VD: 12A3">
          <div class="hint">C√≥ th·ªÉ s·ª≠a/nh·∫≠p l·∫°i. H·ªá th·ªëng s·∫Ω t·ª± chuy·ªÉn th√†nh IN HOA.</div>
        </div>

        <!-- CCCD -->
        <div class="col-6">
          <label for="cccd">S·ªë CCCD <span class="en">/ Citizen ID</span></label>
          <input id="cccd" name="cccd" type="text" required
                 placeholder="Nh·∫≠p ƒë·ªß 12 s·ªë"
                 inputmode="numeric" pattern="[0-9]{9,12}">
          <div class="hint">Ch·ªâ nh·∫≠p <b>k√Ω t·ª± s·ªë</b>. H·ªá th·ªëng ki·ªÉm tra tr√πng CCCD.</div>
        </div>

        <!-- EMAIL -->
        <div class="col-6">
          <label for="email">Email <span class="en">/ Email</span></label>
          <input id="email" name="email" type="email" required
                 placeholder="VD: hs10a1@example.com" autocomplete="email">
          <div class="hint">D√πng email ƒëang s·ª≠ d·ª•ng ƒë·ªÉ nh·∫≠n th√¥ng b√°o &amp; k·∫øt qu·∫£.</div>
        </div>

        <!-- GHI CH√ö -->
        <div class="col-12">
          <label for="ghichu">Ghi ch√∫ <span class="en">/ Notes</span></label>
          <textarea id="ghichu" name="ghichu"
                    placeholder="VD: Thu·ªôc di·ªán ∆∞u ti√™n, d√¢n t·ªôc thi·ªÉu s·ªë, l·ªõp ƒë·∫∑c bi·ªát,..."></textarea>
        </div>
      </div>

      <button class="btn-primary" type="submit">
        <span class="icon">üöÄ</span>G·ª≠i ƒëƒÉng k√Ω
      </button>

      <button class="btn-ghost" type="button" onclick="resetForm()">
        üîÑ X√≥a nhanh to√†n b·ªô n·ªôi dung v·ª´a nh·∫≠p
      </button>
    </form>

    <!-- QR CODE -->
    <div class="qr-wrap">
      <div class="hint" style="margin-bottom:6px;">
        Ho·∫∑c qu√©t QR n√†y ƒë·ªÉ m·ªü trang ƒëƒÉng k√Ω tr√™n ƒëi·ªán tho·∫°i:
      </div>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=https%3A%2F%2Ftrungk8.github.io%2FDTAI_Online%2F"
           alt="QR Code ƒëƒÉng k√Ω">
    </div>
  </section>

  <!-- V√ÄO THI -->
  <section id="exam" class="card hidden">
    <h2><span class="icon">‚ñ∂Ô∏è</span>V√†o thi tr·ª±c tuy·∫øn</h2>
    <div class="muted">
      Ch·ªçn ƒë√∫ng <b>kh·ªëi</b> v√† <b>m√¥n/ƒë·ªÅ</b>. H·ªá th·ªëng s·∫Ω chuy·ªÉn sang Google Form ho·∫∑c Quiz t∆∞∆°ng ·ª©ng.
      (Th·∫ßy thay link th·∫≠t c·ªßa t·ª´ng ƒë·ªÅ).
    </div>

    <div class="exam-grid">
      <!-- KH·ªêI 10 -->
      <div class="exam-card">
        <span class="badge">Kh·ªëi 10</span>
        <h3>ƒê·ªÅ tr·∫Øc nghi·ªám S·ª≠ 10 ‚Äì Ch∆∞∆°ng 1</h3>
        <p>Th·ªùi gian: 30 ph√∫t ¬∑ 25 c√¢u ¬∑ T·ª± l∆∞u ƒëi·ªÉm.</p>
        <a class="pill-btn"
           href="https://forms.gle/THAY_LINK_FORM_KHOI10_SU1"
           target="_blank" rel="noopener">
          üëâ V√†o l√†m b√†i
        </a>
      </div>

      <!-- KH·ªêI 11 -->
      <div class="exam-card">
        <span class="badge">Kh·ªëi 11</span>
        <h3>ƒê·ªÅ tr·∫Øc nghi·ªám S·ª≠ 11 ‚Äì √în HKI</h3>
        <p>Th·ªùi gian: 40 ph√∫t ¬∑ 30 c√¢u ¬∑ T·ª± ch·∫•m.</p>
        <a class="pill-btn"
           href="https://forms.gle/THAY_LINK_FORM_KHOI11_SU"
           target="_blank" rel="noopener">
          üëâ V√†o l√†m b√†i
        </a>
      </div>

      <!-- KH·ªêI 12 -->
      <div class="exam-card">
        <span class="badge">Kh·ªëi 12</span>
        <h3>ƒê·ªÅ luy·ªán thi TN THPT ‚Äì S·ª≠ 12</h3>
        <p>Th·ªùi gian: 50 ph√∫t ¬∑ 40 c√¢u ¬∑ Random c√¢u h·ªèi.</p>
        <a class="pill-btn"
           href="https://forms.gle/THAY_LINK_FORM_KHOI12_SU"
           target="_blank" rel="noopener">
          üëâ V√†o l√†m b√†i
        </a>
      </div>

      <!-- M·∫™U TH√äM -->
      <div class="exam-card">
        <span class="badge">M·ªçi kh·ªëi</span>
        <h3>ƒê·ªÅ th·ª≠ h·ªá th·ªëng / kh·∫£o s√°t nhanh</h3>
        <p>D√πng ƒë·ªÉ test h·ªá th·ªëng ho·∫∑c kh·∫£o s√°t √Ω ki·∫øn h·ªçc sinh.</p>
        <a class="pill-btn"
           href="https://forms.gle/THAY_LINK_FORM_KHAO_SAT"
           target="_blank" rel="noopener">
          üß™ L√†m kh·∫£o s√°t
        </a>
      </div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="review" class="card hidden">
    <h2><span class="icon">üìä</span>Dashboard ‚Äì Th·ªëng k√™ ƒëƒÉng k√Ω</h2>
    <div class="muted">
      Dashboard ƒë·ªçc tr·ª±c ti·∫øp d·ªØ li·ªáu t·ª´ Google Sheet (qua Web App).
      Th·∫ßy nh·ªõ chia s·∫ª Sheet d·∫°ng <b>Anyone with link ‚Äì Viewer</b> n·∫øu mu·ªën d√πng tr√™n GitHub.
    </div>

    <div id="dash-loading" class="muted" style="margin-top:10px;">
      ‚è≥ ƒêang t·∫£i d·ªØ li·ªáu th·ªëng k√™...
    </div>

    <div id="dash-content" class="hidden">
      <div class="stat-row">
        <div class="stat-card">
          <h4>T·ªïng s·ªë h·ªçc sinh</h4>
          <div class="big" id="stat-total">0</div>
          <div class="muted">T·∫•t c·∫£ kh·ªëi/l·ªõp</div>
        </div>
        <div class="stat-card">
          <h4>Kh·ªëi 10</h4>
          <div class="big" id="stat-k10">0</div>
          <div class="muted">Sƒ© s·ªë t·∫°m th·ªùi</div>
        </div>
        <div class="stat-card">
          <h4>Kh·ªëi 11</h4>
          <div class="big" id="stat-k11">0</div>
          <div class="muted">Sƒ© s·ªë t·∫°m th·ªùi</div>
        </div>
        <div class="stat-card">
          <h4>Kh·ªëi 12</h4>
          <div class="big" id="stat-k12">0</div>
          <div class="muted">Sƒ© s·ªë t·∫°m th·ªùi</div>
        </div>
      </div>

      <h3 style="font-size:1rem;margin-top:14px;margin-bottom:6px;">
        B·∫£ng sƒ© s·ªë theo l·ªõp
      </h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>L·ªõp</th>
              <th>Sƒ© s·ªë</th>
            </tr>
          </thead>
          <tbody id="tbl-lop">
          </tbody>
        </table>
      </div>
    </div>
  </section>
</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec";

  function show(sectionId){
    document.getElementById("reg").classList.add("hidden");
    document.getElementById("exam").classList.add("hidden");
    document.getElementById("review").classList.add("hidden");

    document.getElementById("btn-reg").classList.remove("active");
    document.getElementById("btn-exam").classList.remove("active");
    document.getElementById("btn-review").classList.remove("active");

    if(sectionId==="reg"){
      document.getElementById("reg").classList.remove("hidden");
      document.getElementById("btn-reg").classList.add("active");
    }else if(sectionId==="exam"){
      document.getElementById("exam").classList.remove("hidden");
      document.getElementById("btn-exam").classList.add("active");
    }else if(sectionId==="review"){
      document.getElementById("review").classList.remove("hidden");
      document.getElementById("btn-review").classList.add("active");
      if(!window._dashboardLoaded){
        loadDashboard();
        window._dashboardLoaded = true;
      }
    }
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function resetForm(){
    document.getElementById("registerForm").reset();
  }

  // Auto IN HOA H·ªå T√äN + L·ªöP
  const hotenInput = document.getElementById("hoten");
  hotenInput.addEventListener("blur", () => {
    hotenInput.value = hotenInput.value.toUpperCase();
  });
  const malopInput = document.getElementById("malop");
  malopInput.addEventListener("blur", () => {
    malopInput.value = malopInput.value.toUpperCase();
  });

  // ƒê·ªìng b·ªô preset l·ªõp -> √¥ nh·∫≠p
  const lopPreset = document.getElementById("lopPreset");
  lopPreset.addEventListener("change", () => {
    if(lopPreset.value){
      malopInput.value = lopPreset.value.toUpperCase();
    }
  });

  // Hi·ªán √¥ "tr∆∞·ªùng kh√°c" & "t·ªânh kh√°c"
  document.getElementById("truong").addEventListener("change", e=>{
    document.getElementById("truong_khac").classList.toggle("hidden", e.target.value !== "");
  });
  document.getElementById("tinh").addEventListener("change", e=>{
    document.getElementById("tinh_khac").classList.toggle("hidden", e.target.value !== "");
  });

  /* DASHBOARD ‚Äì L·∫§Y D·ªÆ LI·ªÜU B·∫∞NG JSONP */
  function loadDashboard(){
    const s = document.createElement("script");
    const cbName = "renderDashboard";
    s.src = SCRIPT_URL + "?mode=stats&callback=" + cbName + "&_=" + Date.now();
    document.body.appendChild(s);
  }

  function renderDashboard(data){
    try{
      document.getElementById("dash-loading").classList.add("hidden");
      document.getElementById("dash-content").classList.remove("hidden");

      const total = data.total || 0;
      const byKhoi = data.byKhoi || {};
      const byLop  = data.byLop || {};

      document.getElementById("stat-total").textContent = total;
      document.getElementById("stat-k10").textContent = byKhoi["10"] || 0;
      document.getElementById("stat-k11").textContent = byKhoi["11"] || 0;
      document.getElementById("stat-k12").textContent = byKhoi["12"] || 0;

      const tbody = document.getElementById("tbl-lop");
      tbody.innerHTML = "";
      const entries = Object.entries(byLop).sort((a,b)=>a[0].localeCompare(b[0]));
      entries.forEach(([lop,count])=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td><span class="badge-khoi">${lop}</span></td><td>${count}</td>`;
        tbody.appendChild(tr);
      });
      if(entries.length===0){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="2" class="muted">Ch∆∞a c√≥ d·ªØ li·ªáu.</td>`;
        tbody.appendChild(tr);
      }
    }catch(err){
      document.getElementById("dash-loading").textContent =
        "C√≥ l·ªói khi t·∫£i th·ªëng k√™: " + err;
      document.getElementById("dash-loading").classList.remove("hidden");
    }
  }
</script>
</body>
</html>
