<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online | THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js cho Dashboard -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --primary:#1d4ed8;          /* Xanh d∆∞∆°ng */
      --primary-soft:#dbeafe;
      --secondary:#06b6d4;        /* Xanh ng·ªçc */
      --accent:#f97316;           /* Cam nh·∫°t */
      --bg:#e5e7eb;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow-lg:0 20px 50px rgba(15,23,42,.18);
      --radius-lg:20px;
    }
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:"Be Vietnam Pro",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#e0f2fe,#f9fafb);
      min-height:100vh;
      padding:16px 10px 26px;
      color:#0f172a;
    }
    .wrap{
      max-width:1120px;
      margin:0 auto;
    }

    /* ===== HEADER + LOGO ===== */
    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      margin-bottom:16px;
    }
    .logo-box{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-box img{
      width:70px;
      height:70px;
      border-radius:18px;
      object-fit:cover;
      box-shadow:0 10px 25px rgba(15,23,42,.28);
      background:#fff;
      padding:6px;
    }
    header h1{
      font-size:1.4rem;
      margin-bottom:4px;
      color:#111827;
    }
    header p{
      font-size:.85rem;
      color:var(--muted);
    }
    .school-tag{
      font-weight:600;
      font-size:.9rem;
      color:var(--primary);
    }
    .badge-top{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(6,182,212,.08);
      color:#0f766e;
      font-size:.75rem;
      font-weight:500;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .badge-top span.dot{
      width:7px;height:7px;border-radius:999px;background:#22c55e;
      box-shadow:0 0 0 4px rgba(34,197,94,.25);
    }

    /* ===== NAV ===== */
    nav{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:16px;
    }
    nav button{
      border:none;
      border-radius:999px;
      padding:7px 15px;
      font-size:.86rem;
      font-weight:500;
      cursor:pointer;
      background:#ffffffdd;
      color:#334155;
      box-shadow:0 10px 26px rgba(15,23,42,.1);
      display:inline-flex;
      align-items:center;
      gap:7px;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
    }
    nav button:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 32px rgba(15,23,42,.16);
    }
    nav button.active{
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;
      box-shadow:0 16px 38px rgba(37,99,235,.6);
    }
    nav button span.icon{font-size:1rem;}

    /* ===== SECTIONS ===== */
    main{display:block;}
    section.page{
      display:none;
      background:var(--card);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-lg);
      padding:18px 16px 16px;
      border:1px solid rgba(148,163,184,.32);
    }
    section.page.active{display:block;}

    h2.section-title{
      font-size:1.08rem;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    h2.section-title span.head-icon{
      width:22px;height:22px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,var(--primary-soft),#fefce8);
      color:#334155;font-size:.9rem;
    }
    p.section-desc{
      font-size:.86rem;
      color:var(--muted);
      margin-bottom:13px;
    }

    /* ===== FORM ƒêƒÇNG K√ù ===== */
    .grid-2{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
      gap:10px 15px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    label{
      font-size:.8rem;
      font-weight:600;
      color:#1f2937;
    }
    label span.en{
      font-weight:400;
      font-size:.74rem;
      color:var(--muted);
    }
    input,select,textarea{
      border-radius:11px;
      border:1px solid #d1d5db;
      padding:8px 10px;
      font-size:.9rem;
      outline:none;
      width:100%;
      background:#f9fafb;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,.32);
      background:#ffffff;
    }
    textarea{min-height:60px;resize:vertical;}
    .hint{
      font-size:.75rem;
      color:var(--muted);
    }
    .btn-primary{
      margin-top:11px;
      border:none;
      border-radius:999px;
      padding:9px 19px;
      font-size:.9rem;
      font-weight:600;
      color:#fff;
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      box-shadow:0 14px 32px rgba(37,99,235,.6);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:7px;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .btn-primary:hover{
      transform:translateY(-1px);
      box-shadow:0 18px 40px rgba(37,99,235,.7);
    }
    .btn-primary span.icon{font-size:1rem;}
    .note-small{
      margin-top:6px;
      font-size:.78rem;
      color:var(--muted);
    }

    .qr-box{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:7px;
    }
    .qr-box img{
      border-radius:26px;
      box-shadow:0 20px 52px rgba(15,23,42,.26);
      background:#fff;
      padding:12px;
      max-width:220px;
      width:100%;
    }

    /* ===== DASHBOARD ===== */
    .cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
      gap:10px;
      margin-bottom:13px;
    }
    .card-mini{
      background:linear-gradient(145deg,#eff6ff,#fefce8);
      border-radius:15px;
      padding:10px 11px;
      box-shadow:0 12px 30px rgba(15,23,42,.12);
      position:relative;
      overflow:hidden;
    }
    .card-mini::after{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top right,rgba(244,114,182,.18),transparent);
      pointer-events:none;
    }
    .card-mini h3{
      font-size:.78rem;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.04em;
      margin-bottom:4px;
    }
    .card-mini .value{
      font-size:1.45rem;
      font-weight:700;
    }
    .card-mini .sub{
      font-size:.78rem;
      color:#4b5563;
      margin-top:2px;
    }
    .grid-charts{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:13px;
    }
    .chart-card{
      background:#f9fafb;
      border-radius:18px;
      padding:10px 11px 12px;
      box-shadow:0 16px 40px rgba(15,23,42,.12) inset;
      display:flex;
      flex-direction:column;
      min-height:210px;
    }
    .chart-card h3{
      font-size:.9rem;margin-bottom:3px;
    }
    .chart-card p{
      font-size:.78rem;color:var(--muted);margin-bottom:7px;
    }
    .chart-wrapper{flex:1;min-height:160px;}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 8px;
      border-radius:999px;
      background:var(--primary-soft);
      color:var(--primary);
      font-size:.75rem;
      margin-top:3px;
    }
    .badge span.dot{
      width:7px;height:7px;border-radius:999px;background:var(--primary);
    }

    /* ===== XEM K·∫æT QU·∫¢ ===== */
    .results{
      margin-top:9px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:10px;
    }
    .result-card{
      background:#f9fafb;
      border-radius:18px;
      padding:10px 11px;
      box-shadow:0 18px 45px rgba(15,23,42,.16) inset;
      position:relative;
      overflow:hidden;
      border:1px solid rgba(148,163,184,.35);
    }
    .result-card::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(135deg,rgba(37,99,235,.06),transparent);
      pointer-events:none;
    }
    .result-name{
      font-size:1rem;
      font-weight:700;
      text-transform:uppercase;
      margin-bottom:3px;
      letter-spacing:.02em;
    }
    .pill-score{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 8px;
      border-radius:999px;
      background:#ecfdf3;
      color:#166534;
      font-size:.78rem;
      margin-bottom:4px;
    }
    .pill-score span.score{
      font-size:1.3rem;
      font-weight:700;
    }
    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:3px 8px;
      margin-top:4px;
      font-size:.76rem;
      color:var(--muted);
    }
    .badge-meta{
      padding:2px 7px;
      border-radius:999px;
      background:#e5e7eb;
    }
    .status-msg{
      margin-top:8px;
      font-size:.82rem;
    }
    .status-empty{color:var(--muted);}
    .status-error{color:#b91c1c;}

    /* ===== RESPONSIVE ===== */
    @media(max-width:640px){
      header{
        flex-direction:column;
        align-items:flex-start;
      }
      .logo-box img{
        width:60px;height:60px;
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo-box">
      <!-- üîÅ THAY ƒë∆∞·ªùng d·∫´n logo th·∫≠t ·ªü ƒë√¢y -->
      <img src="logo-ndc.png" alt="Logo THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu">
      <div>
        <div class="school-tag">TR∆Ø·ªúNG THPT NGUY·ªÑN ƒê√åNH CHI·ªÇU ‚Äì L√ÇM ƒê·ªíNG</div>
        <h1>SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online</h1>
        <p>T√≠ch h·ª£p ƒêƒÉng k√Ω ‚Äì L√†m b√†i ‚Äì Dashboard ‚Äì Tra c·ª©u k·∫øt qu·∫£ trong m·ªôt n·ªÅn t·∫£ng.</p>
      </div>
    </div>
    <div class="badge-top">
      <span class="dot"></span>
      <span>Phi√™n b·∫£n PREMIUM ¬∑ ƒê·ªìng b·ªô Apps Script + Google Sheet</span>
    </div>
  </header>

  <nav>
    <button class="active" onclick="show('reg', this)"><span class="icon">üìù</span>ƒêƒÉng k√Ω</button>
    <button onclick="show('login', this)"><span class="icon">üîê</span>ƒêƒÉng nh·∫≠p</button>
    <button onclick="show('exam', this)"><span class="icon">üß™</span>V√†o thi</button>
    <button onclick="show('review', this)"><span class="icon">üìÑ</span>Xem l·∫°i</button>
    <button onclick="show('dash', this)"><span class="icon">üìä</span>Dashboard</button>
    <button onclick="show('lookup', this)"><span class="icon">üîé</span>Xem k·∫øt qu·∫£</button>
  </nav>

  <main>
    <!-- 1. ƒêƒÇNG K√ù -->
    <section id="reg" class="page active">
      <h2 class="section-title">
        <span class="head-icon">üìù</span>
        ƒêƒÉng k√Ω tham gia h·ªá th·ªëng
      </h2>
      <p class="section-desc">
        H·ªçc sinh ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin; h·ªá th·ªëng t·ª± chu·∫©n h√≥a <b>H·ªå T√äN</b> th√†nh IN HOA, ki·ªÉm tra tr√πng <b>CCCD</b> ho·∫∑c <b>Email</b> tr∆∞·ªõc khi ghi v√†o Google Sheet.
      </p>

      <!-- üëâ THAY URL WEB APP T·∫†I ƒê√ÇY -->
      <form id="regForm"
            method="post"
            action="https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec">
        <div class="grid-2">
          <div class="field">
            <label for="hoten">H·ªç v√† t√™n <span class="en">/ Full name</span></label>
            <input id="hoten" name="hoten" placeholder="VD: Nguy·ªÖn VƒÉn A" required />
            <div class="hint">C√≥ th·ªÉ nh·∫≠p th∆∞·ªùng; h·ªá th·ªëng s·∫Ω t·ª± chuy·ªÉn sang IN HOA khi l∆∞u.</div>
          </div>
          <div class="field">
            <label for="ngaysinh">Ng√†y sinh <span class="en">/ Date of birth</span></label>
            <input id="ngaysinh" name="ngaysinh" type="date" />
          </div>
          <div class="field">
            <label for="gioitinh">Gi·ªõi t√≠nh <span class="en">/ Gender</span></label>
            <select id="gioitinh" name="gioitinh">
              <option value="">-- Ch·ªçn / Select --</option>
              <option>Nam</option>
              <option>N·ªØ</option>
              <option>Kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="dantoc">D√¢n t·ªôc <span class="en">/ Ethnicity</span></label>
            <select id="dantoc" name="dantoc">
              <option value="">Kinh</option>
              <option>√ä-ƒë√™</option>
              <option>M'N√¥ng</option>
              <option>C∆°-ho</option>
              <option>Ba-na</option>
              <option>Kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="truong">Tr∆∞·ªùng <span class="en">/ School</span></label>
            <select id="truong" name="truong">
              <option>THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu</option>
              <option>THPT Ph·∫°m VƒÉn ƒê·ªìng</option>
              <option>THPT B·∫£o L·ªôc</option>
              <option>THPT ƒê·ª©c Tr·ªçng</option>
              <option>Tr∆∞·ªùng kh√°c (ghi ·ªü Ghi ch√∫)</option>
            </select>
            <div class="hint">N·∫øu tr∆∞·ªùng ch∆∞a c√≥ trong danh s√°ch, ch·ªçn ‚ÄúTr∆∞·ªùng kh√°c‚Äù v√† ghi r√µ ·ªü m·ª•c Ghi ch√∫.</div>
          </div>
          <div class="field">
            <label for="xa">X√£/Ph∆∞·ªùng <span class="en">/ Commune</span></label>
            <input id="xa" name="xa" placeholder="VD: X√£ Ki·∫øn ƒê·ª©c" />
          </div>
          <div class="field">
            <label for="tinh">T·ªânh/TP <span class="en">/ Province</span></label>
            <select id="tinh" name="tinh">
              <option>L√¢m ƒê·ªìng</option>
              <option>ƒê·∫Øk L·∫Øk</option>
              <option>ƒê·∫Øk N√¥ng</option>
              <option>TP. H·ªì Ch√≠ Minh</option>
              <option>H√† N·ªôi</option>
              <option value="Kh√°c">T·ªânh/TP kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="khoi">Kh·ªëi <span class="en">/ Grade</span></label>
            <select id="khoi" name="khoi" required>
              <option value="">-- Ch·ªçn kh·ªëi --</option>
              <option>10</option>
              <option>11</option>
              <option>12</option>
            </select>
          </div>
          <div class="field">
            <label for="malop">L·ªõp <span class="en">/ Class</span></label>
            <input id="malop" name="malop" placeholder="VD: 12A1" />
            <div class="hint">Nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng: 10A1, 11A2, 12A5,‚Ä¶</div>
          </div>
          <div class="field">
            <label for="cccd">CCCD <span class="en">/ Citizen ID</span></label>
            <input id="cccd" name="cccd" inputmode="numeric" placeholder="Ch·ªâ nh·∫≠p s·ªë" />
            <div class="hint">H·ªá th·ªëng l∆∞u CCCD d·∫°ng chu·ªói k√Ω t·ª± s·ªë (kh√¥ng x·ª≠ l√Ω to√°n h·ªçc tr√™n tr∆∞·ªùng n√†y).</div>
          </div>
          <div class="field">
            <label for="email">Email <span class="en">/ Email</span></label>
            <input id="email" name="email" type="email" placeholder="VD: ten@gmail.com" />
            <div class="hint">D√πng ƒë·ªÉ g·ª≠i email x√°c nh·∫≠n ƒëƒÉng k√Ω v√† th√¥ng b√°o ph√≤ng thi.</div>
          </div>
          <div class="field">
            <label for="ghichu">Ghi ch√∫ th√™m <span class="en">/ Note</span></label>
            <textarea id="ghichu" name="ghichu" placeholder="VD: Tr∆∞·ªùng kh√°c, ho√†n c·∫£nh ƒë·∫∑c bi·ªát, ..."></textarea>
          </div>
        </div>

        <button type="submit" class="btn-primary">
          <span class="icon">‚úÖ</span><span>G·ª≠i ƒëƒÉng k√Ω / Submit</span>
        </button>
        <div class="note-small">
          Sau khi g·ª≠i, h·ªá th·ªëng s·∫Ω hi·ªÉn th·ªã th√¥ng b√°o <b>Th√†nh c√¥ng</b> ho·∫∑c <b>Tr√πng th√¥ng tin</b> v√† g·ª≠i email cho h·ªçc sinh (n·∫øu c√≥).
        </div>
      </form>

      <div class="qr-box">
        <div class="hint">Qu√©t QR ƒë·ªÉ m·ªü trang ƒëƒÉng k√Ω tr√™n ƒëi·ªán tho·∫°i (mobile friendly):</div>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=https%3A%2F%2Ftrungk8.github.io%2FDTAI_Online%2F"
             alt="QR Code ƒëƒÉng k√Ω"/>
      </div>
    </section>

    <!-- 2. ƒêƒÇNG NH·∫¨P (demo) -->
    <section id="login" class="page">
      <h2 class="section-title"><span class="head-icon">üîê</span>ƒêƒÉng nh·∫≠p (demo)</h2>
      <p class="section-desc">
        Khu v·ª±c n√†y c√≥ th·ªÉ d√πng cho gi√°o vi√™n / qu·∫£n tr·ªã. Hi·ªán t·∫°i giao di·ªán ch·ªâ minh h·ªça, ch∆∞a k·∫øt n·ªëi h·ªá th·ªëng ƒëƒÉng nh·∫≠p th·∫≠t.
      </p>
      <div class="grid-2">
        <div class="field">
          <label>T√†i kho·∫£n</label>
          <input placeholder="T√†i kho·∫£n gi√°o vi√™n / qu·∫£n tr·ªã" />
        </div>
        <div class="field">
          <label>M·∫≠t kh·∫©u</label>
          <input type="password" placeholder="M·∫≠t kh·∫©u" />
        </div>
      </div>
      <button class="btn-primary" type="button" onclick="alert('Demo giao di·ªán ‚Äì ch∆∞a k·∫øt n·ªëi h·ªá th·ªëng ƒëƒÉng nh·∫≠p.')">
        <span class="icon">üîê</span><span>ƒêƒÉng nh·∫≠p (demo)</span>
      </button>
    </section>

    <!-- 3. V√ÄO THI -->
    <section id="exam" class="page">
      <h2 class="section-title"><span class="head-icon">üß™</span>V√†o thi</h2>
      <p class="section-desc">
        D√°n li√™n k·∫øt Google Form/Quiz c·ªßa b√†i ki·ªÉm tra, h·ªçc sinh ch·ªâ vi·ªác b·∫•m n√∫t l√† v√†o thi. C√≥ th·ªÉ thay ƒë·ªïi link theo t·ª´ng ƒë·ª£t.
      </p>
      <div class="field">
        <label>Li√™n k·∫øt b√†i ki·ªÉm tra (Google Form/Quiz)</label>
        <input id="examLink" placeholder="https://docs.google.com/forms/..." value="" />
      </div>
      <button class="btn-primary" type="button" onclick="openExam()">
        <span class="icon">üöÄ</span><span>M·ªü b√†i ki·ªÉm tra</span>
      </button>
    </section>

    <!-- 4. XEM L·∫†I (link Sheet) -->
    <section id="review" class="page">
      <h2 class="section-title"><span class="head-icon">üìÑ</span>Xem l·∫°i d·ªØ li·ªáu g·ªëc</h2>
      <p class="section-desc">
        ƒê·∫∑t li√™n k·∫øt t·ªõi Google Sheet ƒëi·ªÉm (DiemThi) ƒë·ªÉ qu·∫£n tr·ªã c√≥ th·ªÉ m·ªü nhanh file g·ªëc, xem ‚Äì l·ªçc ‚Äì in ‚Äì t·∫£i Excel.
      </p>
      <div class="field">
        <label>Li√™n k·∫øt Google Sheet ƒëi·ªÉm (DiemThi)</label>
        <input id="sheetLink" placeholder="https://docs.google.com/spreadsheets/..." value="" />
      </div>
      <button class="btn-primary" type="button" onclick="openSheet()">
        <span class="icon">üìÇ</span><span>M·ªü sheet ƒëi·ªÉm</span>
      </button>
    </section>

    <!-- 5. DASHBOARD -->
    <section id="dash" class="page">
      <h2 class="section-title"><span class="head-icon">üìä</span>Dashboard th·ªëng k√™</h2>
      <p class="section-desc">
        Th·ªëng k√™ s·ªë l∆∞·ª£ng b√†i thi theo <b>Kh·ªëi</b>, <b>L·ªõp</b>, <b>Gi·ªõi t√≠nh</b>, <b>D√¢n t·ªôc</b>, <b>Tr∆∞·ªùng</b>. D·ªØ li·ªáu l·∫•y tr·ª±c ti·∫øp t·ª´ sheet ƒëi·ªÉm DiemThi (mode=<code>stats</code>).
      </p>

      <div class="cards">
        <div class="card-mini">
          <h3>T·ªïng s·ªë b√†i thi</h3>
          <div class="value" id="dashTotal">‚Äì</div>
          <div class="sub" id="dashTotalNote">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
        </div>
        <div class="card-mini">
          <h3>S·ªë kh·ªëi</h3>
          <div class="value" id="dashGrade">‚Äì</div>
          <div class="sub">Kh·ªëi c√≥ √≠t nh·∫•t 1 h·ªçc sinh l√†m b√†i.</div>
        </div>
        <div class="card-mini">
          <h3>S·ªë l·ªõp</h3>
          <div class="value" id="dashClass">‚Äì</div>
          <div class="sub">T·ªïng s·ªë l·ªõp xu·∫•t hi·ªán trong sheet ƒëi·ªÉm.</div>
        </div>
        <div class="card-mini">
          <h3>S·ªë tr∆∞·ªùng</h3>
          <div class="value" id="dashSchool">‚Äì</div>
          <div class="sub">Tr∆∞·ªùng c√≥ h·ªçc sinh tham gia b√†i ki·ªÉm tra.</div>
        </div>
      </div>

      <div class="grid-charts">
        <div class="chart-card">
          <h3>Ph√¢n b·ªë theo Kh·ªëi</h3>
          <p>S·ªë b√†i thi theo kh·ªëi 10 / 11 / 12.</p>
          <div class="chart-wrapper"><canvas id="chartGrade"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Top l·ªõp c√≥ nhi·ªÅu b√†i thi</h3>
          <p>Nh·ªØng l·ªõp c√≥ s·ªë l∆∞·ª£t l√†m b√†i cao nh·∫•t.</p>
          <div class="chart-wrapper"><canvas id="chartClass"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>Gi·ªõi t√≠nh</h3>
          <p>T·ª∑ l·ªá Nam / N·ªØ / Kh√°c.</p>
          <div class="chart-wrapper"><canvas id="chartGender"></canvas></div>
        </div>
        <div class="chart-card">
          <h3>D√¢n t·ªôc / Tr∆∞·ªùng</h3>
          <p>Top d√¢n t·ªôc v√† tr∆∞·ªùng c√≥ nhi·ªÅu l∆∞·ª£t l√†m b√†i.</p>
          <div class="badge"><span class="dot"></span><span>Ch·ªâ hi·ªÉn th·ªã Top 6 m·ª•c.</span></div>
          <div class="chart-wrapper" style="margin-top:6px;"><canvas id="chartEthnicSchool"></canvas></div>
        </div>
      </div>
    </section>

    <!-- 6. XEM K·∫æT QU·∫¢ -->
    <section id="lookup" class="page">
      <h2 class="section-title"><span class="head-icon">üîé</span>Xem l·∫°i k·∫øt qu·∫£ b√†i thi</h2>
      <p class="section-desc">
        Tra c·ª©u nhanh t·ª´ sheet DiemThi: ∆∞u ti√™n theo <b>CCCD</b>, ho·∫∑c theo <b>H·ªç t√™n (IN HOA)</b> + <b>L·ªõp</b> n·∫øu kh√¥ng c√≥ CCCD.
      </p>

      <form id="searchForm">
        <div class="grid-2">
          <div class="field">
            <label for="s_cccd">CCCD (∆∞u ti√™n)</label>
            <input id="s_cccd" name="cccd" inputmode="numeric" placeholder="Ch·ªâ nh·∫≠p s·ªë, VD: 0790xxxxxxx" />
            <div class="hint">N·∫øu nh·∫≠p CCCD, h·ªá th·ªëng s·∫Ω t√¨m ch√≠nh x√°c theo CCCD tr∆∞·ªõc.</div>
          </div>
          <div class="field">
            <label for="s_name">H·ªç t√™n (IN HOA)</label>
            <input id="s_name" name="name" placeholder="VD: NGUY·ªÑN VƒÇN A" />
            <div class="hint">C√≥ th·ªÉ nh·∫≠p th∆∞·ªùng; khi g·ª≠i h·ªá th·ªëng t·ª± chuy·ªÉn sang IN HOA.</div>
          </div>
          <div class="field">
            <label for="s_class">L·ªõp</label>
            <input id="s_class" name="className" placeholder="VD: 12A1" />
            <div class="hint">C√≥ th·ªÉ b·ªè tr·ªëng L·ªõp (s·∫Ω t√¨m theo H·ªç t√™n tr√™n to√†n b·ªô kh·ªëi).</div>
          </div>
        </div>
        <button type="submit" class="btn-primary">
          <span class="icon">üîé</span><span>Tra c·ª©u k·∫øt qu·∫£</span>
        </button>
      </form>
      <div id="status" class="status-msg status-empty"></div>
      <div id="results" class="results"></div>
    </section>
  </main>
</div>

<script>
  // üëâ NH·ªö C·∫¨P NH·∫¨T C√ôNG M·ªòT URL V·ªöI action C·ª¶A FORM
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec";

  function show(id, btn){
    document.querySelectorAll("section.page").forEach(sec=>{
      sec.classList.toggle("active", sec.id === id);
    });
    if(btn){
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
    }
  }

  function openExam(){
    const link = document.getElementById("examLink").value.trim();
    if(!link){ alert("Th·∫ßy/c√¥ nh·∫≠p link Google Form/Quiz tr∆∞·ªõc ƒë√£ nh√©."); return; }
    window.open(link,"_blank");
  }
  function openSheet(){
    const link = document.getElementById("sheetLink").value.trim();
    if(!link){ alert("Nh·∫≠p link Google Sheet ƒëi·ªÉm DiemThi tr∆∞·ªõc ƒë√£."); return; }
    window.open(link,"_blank");
  }

  // --------- JSONP helper ---------
  function callJsonp(url, callbackName){
    return new Promise(resolve=>{
      window[callbackName] = function(data){ resolve(data); };
      const s = document.createElement("script");
      s.src = url + (url.indexOf("?")>=0 ? "&" : "?") + "callback=" + callbackName;
      document.body.appendChild(s);
    });
  }

  // ---------- DASHBOARD ----------
  let chartGrade, chartClass, chartGender, chartEthnicSchool;

  function topEntries(obj, limit){
    const arr = Object.entries(obj || {});
    arr.sort((a,b)=> (b[1].count||0)-(a[1].count||0));
    return arr.slice(0,limit);
  }

  async function loadDashboard(){
    try{
      const data = await callJsonp(WEB_APP_URL + "?mode=stats","statsCallback");
      if(!data){ throw new Error("Kh√¥ng c√≥ d·ªØ li·ªáu."); }

      const total = data.total || data.rows || 0;
      document.getElementById("dashTotal").textContent = total;
      document.getElementById("dashTotalNote").textContent = "T·ªïng s·ªë b·∫£n ghi trong sheet ƒëi·ªÉm DiemThi.";

      const grades  = data.byKhoi    || data.byGrade   || {};
      const classes = data.byLop     || data.byClass   || {};
      const genders = data.byGender || {};
      const ethnics = data.byEthnicity || data.byEthnic || {};
      const schools = data.bySchool || {};

      document.getElementById("dashGrade").textContent  = Object.keys(grades).length;
      document.getElementById("dashClass").textContent  = Object.keys(classes).length;
      document.getElementById("dashSchool").textContent = Object.keys(schools).length;

      const gLabels = Object.keys(grades);
      const gValues = gLabels.map(k=>grades[k].count||0);
      draw
