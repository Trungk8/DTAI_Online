<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js cho Dashboard -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --primary:#2563eb;
      --primary-soft:#dbeafe;
      --primary-strong:#1d4ed8;
      --danger:#dc2626;
      --danger-soft:#fee2e2;
      --muted:#6b7280;
      --bg-card:#0b1220;
      --bg-elevated:#020617;
      --border-soft:#1e293b;
      --radius-lg:18px;
    }
    *{
      box-sizing:border-box;
      -webkit-tap-highlight-color:transparent;
    }
    body{
      font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#e0edff,#f9fafb);
      min-height:100vh;
      padding:16px 10px 24px;
      color:#111827;
      font-size:16px;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:12px;
    }
    header h1{
      margin:0;
      font-size:1.15rem;
      font-weight:700;
      letter-spacing:.02em;
      text-transform:uppercase;
      color:#0f172a;
    }
    header p{
      margin:4px 0 0;
      font-size:.9rem;
      color:var(--muted);
    }
    .badge-top{
      margin-top:6px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px;
      border-radius:999px;
      background:#0f172a;
      color:#e5e7eb;
      font-size:.75rem;
    }
    .badge-top span.dot{
      width:7px;height:7px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#38bdf8,#0ea5e9);
      box-shadow:0 0 10px #38bdf8;
    }
    header .avatar-chip{
      min-width:72px;
      max-width:120px;
      background:#020617;
      color:#e5e7eb;
      border-radius:999px;
      padding:6px 10px;
      display:flex;
      align-items:center;
      gap:7px;
      box-shadow:0 14px 40px rgba(15,23,42,.55);
    }
    .avatar-circle{
      width:26px;height:26px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#38bdf8,#4f46e5);
      display:flex;align-items:center;justify-content:center;
      font-size:1rem;
    }
    .avatar-chip span.label{
      font-size:.76rem;
      line-height:1.2;
    }
    nav{
      margin-bottom:14px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    nav button{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-size:.86rem;
      font-weight:500;
      cursor:pointer;
      background:#ffffffb8;
      color:#374151;
      box-shadow:0 8px 22px rgba(15,23,42,.12);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    nav button.active{
      background:linear-gradient(135deg,#2563eb,#4f46e5);
      color:#fff;
      box-shadow:0 12px 30px rgba(37,99,235,.55);
    }
    nav button span.icon{font-size:1rem;}

    main{
      display:block;
    }
    section.page{
      display:none;
      background:radial-gradient(circle at top,#020617,#020617 55%,#030712);
      border-radius:var(--radius-lg);
      padding:14px 14px 16px;
      box-shadow:0 22px 60px rgba(15,23,42,.85);
      color:#e5e7eb;
      border:1px solid #1f2937;
    }
    section.page.active{
      display:block;
    }
    .section-title{
      font-size:1.02rem;
      margin:0 0 4px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .section-title span.badge-inline{
      font-size:.7rem;
      text-transform:uppercase;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(37,99,235,.14);
      border:1px solid rgba(37,99,235,.5);
      color:#bfdbfe;
    }
    .section-desc{
      margin:0 0 10px;
      font-size:.84rem;
      color:#9ca3af;
    }
    .section-desc b{color:#e5e7eb;}

    .grid-2{
      display:grid;
      grid-template-columns:1.1fr 1.1fr;
      gap:10px 14px;
    }
    @media(max-width:768px){
      .grid-2{
        grid-template-columns:1fr;
      }
      header{
        flex-direction:column;
      }
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    label{
      font-size:.9rem;
      font-weight:600;
      color:#111827;
    }
    input,select,textarea{
      border-radius:10px;
      border:1px solid #d1d5db;
      padding:10px 11px;
      font-size:1rem;
      outline:none;
      width:100%;
    }
        .dob-group{
      display:flex;
      gap:6px;
    }
    .dob-group select{
      flex:1;
    }
input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 1px rgba(37,99,235,.35);
    }
    textarea{min-height:60px;resize:vertical;}

    .hint{
      font-size:.75rem;
      color:#9ca3af;
    }
    .row{
      display:flex;
      gap:8px;
    }
    .row > .field{flex:1;}

    .alert{
      margin-top:10px;
      padding:8px 10px;
      border-radius:10px;
      font-size:.78rem;
      line-height:1.4;
    }
    .alert.info{
      background:rgba(37,99,235,.1);
      border:1px solid rgba(37,99,235,.6);
      color:#bfdbfe;
    }
    .alert.warn{
      background:rgba(202,138,4,.1);
      border:1px solid rgba(234,179,8,.7);
      color:#facc15;
    }
    .alert.error{
      background:rgba(248,113,113,.1);
      border:1px solid rgba(220,38,38,.7);
      color:#fecaca;
    }

    .btn-row{
      margin-top:12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .btn-primary,.btn-ghost{
      border-radius:999px;
      border:none;
      padding:8px 14px;
      font-size:.88rem;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      letter-spacing:.02em;
    }
    .btn-primary{
      background:linear-gradient(135deg,#2563eb,#4f46e5);
      color:#fff;
      box-shadow:0 14px 40px rgba(37,99,235,.7);
    }
    .btn-ghost{
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
      border:1px solid #374151;
    }

    .pill-warning{
      font-size:.77rem;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(234,179,8,.08);
      border:1px dashed rgba(234,179,8,.9);
      color:#fde68a;
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:6px;
    }

    /* LOGIN & EXAM */
    .card{
      background:radial-gradient(circle at top,#020617,#020617 55%,#030712);
      border-radius:16px;
      border:1px solid #111827;
      padding:12px 12px 14px;
      box-shadow:0 20px 50px rgba(15,23,42,.85);
      margin-top:4px;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:8px;
    }
    .card-title{
      margin:0;
      font-size:.96rem;
    }
    .card-sub{
      margin:2px 0 0;
      font-size:.8rem;
      color:#9ca3af;
    }
    /* Card tr·∫Øng cho khu v·ª±c Import ƒë·ªÅ */
    .card-light{
      background:#ffffff;
      border-radius:16px;
      padding:14px 14px 16px;
      border:1px solid #e5e7eb;
      box-shadow:0 14px 35px rgba(15,23,42,.12);
      color:#0f172a;
    }
    .card-light h3{
      margin:0 0 6px;
      font-size:.98rem;
    }
    .card-light p{
      margin:3px 0 8px;
      font-size:.85rem;
      color:#4b5563;
    }
    .card-light ol{
      margin:4px 0 8px 18px;
      font-size:.82rem;
      color:#4b5563;
    }
    .card-light code{
      background:#f3f4f6;
      padding:2px 4px;
      border-radius:4px;
      font-size:.8rem;
    }
    .import-note{
      font-size:.78rem;
      color:#6b7280;
      margin-top:6px;
    }
    
    .tag{
      font-size:.7rem;
      border-radius:999px;
      padding:2px 7px;
      border:1px solid rgba(148,163,184,.7);
      color:#e5e7eb;
      background:rgba(15,23,42,.9);
    }
    .timer{
      font-variant-numeric:tabular-nums;
      font-size:1.1rem;
      font-weight:700;
      color:#fbbf24;
    }

    /* DASHBOARD */
    .dashboard-grid{
      display:grid;
      grid-template-columns:1.1fr 1.2fr;
      gap:10px;
      margin-top:6px;
    }
    @media(max-width:900px){
      .dashboard-grid{
        grid-template-columns:1fr;
      }
    }
    .stat-box{
      background:#020617;
      border-radius:16px;
      padding:10px 10px 11px;
      border:1px solid #1f2937;
      box-shadow:0 18px 45px rgba(15,23,42,.9);
    }
    .stat-box h3{
      margin:0 0 6px;
      font-size:.9rem;
    }
    .stat-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:4px;
      font-size:.8rem;
    }
    .stat-row span.label{
      color:#9ca3af;
    }
    .stat-row span.value{
      font-weight:600;
      color:#e5e7eb;
    }
    .chart-card{
      background:#f9fafb;
      border-radius:16px;
      padding:10px 10px 12px;
      box-shadow:0 16px 40px rgba(15,23,42,.12) inset;
      display:flex;
      flex-direction:column;
      min-height:210px;
    }
    .chart-card h3{
      font-size:.9rem;margin-bottom:3px;
    }
    .chart-card p{
      font-size:.78rem;color:var(--muted);margin-bottom:8px;
    }
    .chart-wrapper{flex:1;min-height:160px;}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 7px;
      border-radius:999px;
      background:var(--primary-soft);
      color:var(--primary);
      font-size:.75rem;
      margin-top:3px;
    }
    .badge span.dot{
      width:7px;height:7px;border-radius:999px;background:var(--primary);
    }

    /* TRA C·ª®U */
    #results{
      margin-top:12px;
      font-size:.82rem;
    }
    .result-card{
      background:#020617;
      border-radius:12px;
      border:1px solid #1f2937;
      padding:8px 10px;
      margin-bottom:6px;
    }
    .result-card h4{
      margin:0 0 2px;font-size:.9rem;
    }
    .result-meta{
      display:flex;flex-wrap:wrap;gap:6px;
      font-size:.78rem;color:#9ca3af;
    }
    .status-msg{
      margin-top:8px;
      font-size:.82rem;
    }
    .status-error{color:#fecaca;}
    .status-empty{color:#9ca3af;}

  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>SK ‚Äì H·ªá th·ªëng Ki·ªÉm tra Online</h1>
      <p>ƒêƒÉng k√Ω ‚Äì L√†m b√†i ‚Äì Xem Dashboard ‚Äì Tra c·ª©u k·∫øt qu·∫£ tr√™n c√πng m·ªôt trang.</p>
      <div class="badge-top"><span class="dot"></span><span>Phi√™n b·∫£n PREMIUM</span></div>
    </div>
    <div class="avatar-chip">
      <div class="avatar-circle">AI</div>
      <span class="label">DTAI Online<br/>NDC ‚Äì L√¢m ƒê·ªìng</span>
    </div>
  </header>

  <nav>
    <button class="active" onclick="show('reg', this)"><span class="icon">üìù</span>ƒêƒÉng k√Ω</button>
    <button onclick="show('login', this)"><span class="icon">üîê</span>ƒêƒÉng nh·∫≠p</button>
    <button onclick="show('exam', this)"><span class="icon">üß™</span>V√†o thi</button>
    <button onclick="show('review', this)"><span class="icon">üìÑ</span>Xem l·∫°i</button>
    <button onclick="show('dash', this)"><span class="icon">üìä</span>Dashboard</button>
    <button onclick="show('search', this)"><span class="icon">üîé</span>Xem k·∫øt qu·∫£</button>

  <!-- c√°c n√∫t c≈© -->
  <button onclick="show('reg', this)" class="active"><span class="icon">üìù</span>ƒêƒÉng k√Ω</button>
  <button onclick="show('login', this)"><span class="icon">üîê</span>ƒêƒÉng nh·∫≠p</button>
  <button onclick="show('exam', this)"><span class="icon">üß™</span>V√†o thi</button>
  <button onclick="show('review', this)"><span class="icon">üìÑ</span>Xem l·∫°i</button>
  <button onclick="show('dash', this)"><span class="icon">üìä</span>Dashboard</button>
  <button onclick="show('search', this)"><span class="icon">üîé</span>Xem k·∫øt qu·∫£</button>

  <!-- üëâ TH√äM M·ªöI: Import ƒë·ªÅ -->
  <button onclick="show('import', this)"><span class="icon">üì•</span>Import ƒë·ªÅ Word</button>
    
  </nav>

  <main>
    <!-- 1. ƒêƒÇNG K√ù -->
    <section id="reg" class="page active">
      <h2 class="section-title">ƒêƒÉng k√Ω tham gia h·ªá th·ªëng <span class="badge-inline">Student Registration</span></h2>
      <p class="section-desc">Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin b√™n d∆∞·ªõi. H·ªá th·ªëng t·ª± ki·ªÉm tra tr√πng <b>CCCD</b> ho·∫∑c <b>Email</b> tr∆∞·ªõc khi l∆∞u.</p>

      <!-- üëâ THAY URL WEB APP T·∫†I ƒê√ÇY -->
      <form id="regForm"
            method="post"
            action="https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec">
        <div class="grid-2">
          <div class="field">
            <label for="hoten">H·ªç v√† t√™n (IN HOA)</label>
            <input id="hoten" name="hoten" placeholder="VD: NGUY·ªÑN VƒÇN A" required />
            <div class="hint">Nh·∫≠p th∆∞·ªùng c≈©ng ƒë∆∞·ª£c, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªïi th√†nh IN HOA khi l∆∞u.</div>
          </div>
          <div class="field">
            <label for="dob-day">Ng√†y sinh</label>
            <div class="dob-group">
              <select id="dob-day" aria-label="Ng√†y sinh - ng√†y"></select>
              <select id="dob-month" aria-label="Ng√†y sinh - th√°ng"></select>
              <select id="dob-year" aria-label="Ng√†y sinh - nƒÉm"></select>
              <input type="hidden" id="ngaysinh" name="ngaysinh" />
            </div>
            <div class="hint">Ch·ªçn l·∫ßn l∆∞·ª£t Ng√†y ‚Äì Th√°ng ‚Äì NƒÉm. H·ªá th·ªëng s·∫Ω t·ª± gh√©p th√†nh dd/mm/yyyy.</div>
          </div>
          <div class="field">
            <label for="gioitinh">Gi·ªõi t√≠nh</label>
            <select id="gioitinh" name="gioitinh">
              <option value="">-- Ch·ªçn --</option>
              <option>Nam</option>
              <option>N·ªØ</option>
              <option>Kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="dantoc">D√¢n t·ªôc</label>
            <select id="dantoc" name="dantoc">
              <option>Kinh</option>
              <option>C∆°-ho</option>
              <option>Ba-na</option>
              <option>Kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="truong">Tr∆∞·ªùng</label>
            <select id="truong" name="truong">
              <option>THPT Nguy·ªÖn ƒê√¨nh Chi·ªÉu</option>
              <option>THPT Ph·∫°m VƒÉn ƒê·ªìng</option>
              <option>THPT B·∫£o L·ªôc</option>
              <option>THPT ƒê·ª©c Tr·ªçng</option>
              <option>Tr∆∞·ªùng kh√°c (ghi ch√∫)</option>
            </select>
            <div class="hint">N·∫øu tr∆∞·ªùng ch∆∞a c√≥ trong danh s√°ch, ch·ªçn ‚ÄúTr∆∞·ªùng kh√°c (ghi ch√∫)‚Äù v√† ghi r√µ ·ªü √¥ Ghi ch√∫.</div>
          </div>
          <div class="field">
            <label for="xa">X√£/Ph∆∞·ªùng</label>
            <input id="xa" name="xa" placeholder="VD: X√£ Ki·∫øn ƒê·ª©c" />
          </div>
          <div class="field">
            <label for="tinh">T·ªânh/TP</label>
            <select id="tinh" name="tinh">
              <option>L√¢m ƒê·ªìng</option>
              <option>ƒê·∫Øk L·∫Øk</option>
              <option>ƒê·∫Øk N√¥ng</option>
              <option>TP. H·ªì Ch√≠ Minh</option>
              <option>H√† N·ªôi</option>
              <option value="Kh√°c">T·ªânh/TP kh√°c</option>
            </select>
          </div>
          <div class="field">
            <label for="khoi">Kh·ªëi</label>
            <select id="khoi" name="khoi" required>
              <option value="">-- Ch·ªçn kh·ªëi --</option>
              <option>10</option>
              <option>11</option>
              <option>12</option>
            </select>
          </div>
          <div class="field">
            <label for="malop">L·ªõp</label>
            <input id="malop" name="malop" placeholder="VD: 12A1" />
            <div class="hint">Nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng: 10A1, 11A2, 12A5,‚Ä¶</div>
          </div>
          <div class="field">
            <label for="cccd">CCCD</label>
            <input id="cccd" name="cccd" inputmode="numeric" placeholder="Ch·ªâ nh·∫≠p s·ªë" />
            <div class="hint">H·ªá th·ªëng l∆∞u CCCD d·∫°ng k√Ω t·ª± s·ªë (chu·ªói), kh√¥ng t√≠nh to√°n tr√™n tr∆∞·ªùng n√†y.</div>
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="VD: ten@gmail.com" />
            <div class="hint">D√πng ƒë·ªÉ h·ªá th·ªëng g·ª≠i x√°c nh·∫≠n ƒëƒÉng k√Ω & th√¥ng tin ph√≤ng thi.</div>
          </div>
          <div class="field">
            <label for="ghichu">Ghi ch√∫ th√™m</label>
            <textarea id="ghichu" name="ghichu" placeholder="VD: Tr∆∞·ªùng kh√°c, ho√†n c·∫£nh ƒë·∫∑c bi·ªát, ..."></textarea>
          </div>
        </div>

        <div class="alert warn">
          ‚ö† <b>L∆∞u √Ω th·ªùi gian:</b> Th·∫ßy/c√¥ c√≥ th·ªÉ c·∫•u h√¨nh ca thi gi·ªõi h·∫°n gi·ªù tr√™n h·ªá th·ªëng. H·ªçc sinh n√™n ho√†n th√†nh ƒëƒÉng k√Ω s·ªõm ƒë·ªÉ tr√°nh ngh·∫Ωn.
        </div>

        <div class="btn-row">
          <button type="submit" class="btn-primary">
            <span>G·ª≠i ƒëƒÉng k√Ω / Submit</span>
          </button>
          <button type="reset" class="btn-ghost">
            X√≥a d·ªØ li·ªáu / Reset
          </button>
        </div>
      </form>
    </section>

    <!-- 2. ƒêƒÇNG NH·∫¨P -->
    <section id="login" class="page">
      <h2 class="section-title">ƒêƒÉng nh·∫≠p b·∫±ng CCCD + m·∫≠t kh·∫©u</h2>
      <p class="section-desc">M·ªói h·ªçc sinh s·ª≠ d·ª•ng <b>01 CCCD</b> v√† m·∫≠t kh·∫©u ri√™ng (ƒë∆∞·ª£c g·ª≠i qua email sau khi ƒëƒÉng k√Ω th√†nh c√¥ng).</p>

      <div class="card">
        <div class="card-header">
          <div>
            <h3 class="card-title">Th√¥ng tin ƒëƒÉng nh·∫≠p</h3>
            <p class="card-sub">Nh·∫≠p ƒë√∫ng CCCD & m·∫≠t kh·∫©u ƒë·ªÉ v√†o khu v·ª±c l√†m b√†i / xem k·∫øt qu·∫£.</p>
          </div>
          <span class="tag">SECURE LOGIN</span>
        </div>

        <form id="loginForm">
          <div class="grid-2">
            <div class="field">
              <label for="login-cccd">CCCD</label>
              <input id="login-cccd" name="login-cccd" placeholder="Nh·∫≠p CCCD ƒë√£ ƒëƒÉng k√Ω" inputmode="numeric" />
            </div>
            <div class="field">
              <label for="login-pass">M·∫≠t kh·∫©u</label>
              <input id="login-pass" name="login-pass" type="password" placeholder="M·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i qua email" />
            </div>
          </div>

          <div class="pill-warning">
            ‚è± G·ª£i √Ω: ƒêƒÉng nh·∫≠p tr∆∞·ªõc gi·ªù thi √≠t nh·∫•t 5 ph√∫t ƒë·ªÉ ki·ªÉm tra k·∫øt n·ªëi & th√¥ng tin c√° nh√¢n.
          </div>

          <div class="btn-row">
            <button type="submit" class="btn-primary">
              <span>ƒêƒÉng nh·∫≠p / Login</span>
            </button>
            <button type="button" class="btn-ghost" onclick="alert('Li√™n h·ªá GVCN ho·∫∑c BGH ƒë·ªÉ c·∫•p l·∫°i m·∫≠t kh·∫©u.')">
              Qu√™n m·∫≠t kh·∫©u?
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- 3. V√ÄO THI -->
    <section id="exam" class="page">
      <h2 class="section-title">V√†o thi tr·ª±c tuy·∫øn <span class="badge-inline">Online Exam</span></h2>
      <p class="section-desc">Sau khi ƒëƒÉng nh·∫≠p, h·ªá th·ªëng s·∫Ω t·ª± g·ª£i √Ω m√£ ca thi, ƒë·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c & link ƒë·ªÅ t∆∞∆°ng ·ª©ng.</p>

      <div class="card">
        <div class="card-header">
          <div>
            <h3 class="card-title">Th√¥ng tin ca thi / Exam slot</h3>
            <p class="card-sub">D·ª±a tr√™n m√£ ca thi m√† th·∫ßy/c√¥ ƒë√£ c·∫•u h√¨nh tr∆∞·ªõc trong Google Sheet.</p>
          </div>
          <div style="text-align:right;">
            <div class="timer" id="examTimer">--:--</div>
            <div style="font-size:.7rem;color:#9ca3af;">Th·ªùi gian c√≤n l·∫°i / Time left</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="exam-code">M√£ ca thi</label>
            <input id="exam-code" placeholder="VD: 11A3-TKTx-TOAN-CA1" />
          </div>
          <div class="field">
            <label for="examLink">Link ƒë·ªÅ (Google Form/Quiz)</label>
            <input id="examLink" placeholder="D√°n link ƒë·ªÅ n·∫øu mu·ªën m·ªü th·ªß c√¥ng" />
          </div>
        </div>

        <div class="alert info">
          ‚è∞ V√≠ d·ª• c·∫£nh b√°o: <b>‚Äúƒê·∫øn 08:45 h·ªá th·ªëng s·∫Ω kh√¥ng nh·∫≠n b√†i n·ªØa. H√£y b·∫•m G·ª¨I tr∆∞·ªõc th·ªùi ƒëi·ªÉm n√†y.‚Äù</b><br/>
          Th√¥ng ƒëi·ªáp n√†y c√≥ th·ªÉ sinh t·ª± ƒë·ªông d·ª±a v√†o c·∫•u h√¨nh ca thi trong Sheet <code>CauHinhThi</code>.
        </div>

        <div class="btn-row">
          <button type="button" class="btn-primary" onclick="openExam()">
            <span>V√†o thi / Start exam</span>
          </button>
          <button type="button" class="btn-ghost" onclick="openSheet()">
            Xem c·∫•u h√¨nh ca thi (Sheet)
          </button>
        </div>
      </div>
    </section>

    <!-- 4. XEM L·∫†I -->
    <section id="review" class="page">
      <h2 class="section-title">Xem l·∫°i th√¥ng tin c√° nh√¢n / K·∫øt qu·∫£ g·∫ßn ƒë√¢y</h2>
      <p class="section-desc">T√≠nh nƒÉng n√†y s·∫Ω ƒë·ªçc t·ª´ Sheet ƒëi·ªÉm & ƒëƒÉng k√Ω ƒë·ªÉ hi·ªÉn th·ªã l·∫°i l·ªãch s·ª≠ l√†m b√†i c·ªßa t·ª´ng h·ªçc sinh.</p>

      <div class="alert info">
        üß© Ph·∫ßn n√†y d√πng chung endpoint <code>mode=search</code> ho·∫∑c <code>mode=results</code> (JSONP) trong Code.gs ƒë·ªÉ l·∫•y d·ªØ li·ªáu l·ªãch s·ª≠.
      </div>
    </section>

    <!-- 5. DASHBOARD -->
    <section id="dash" class="page">
      <h2 class="section-title">Dashboard t·ªïng h·ª£p <span class="badge-inline">Overview</span></h2>
      <p class="section-desc">D·ªØ li·ªáu l·∫•y t·ª´ sheet <b>DangKy</b> v√† sheet <b>DiemThi</b> ƒë·ªÉ th·ªëng k√™ theo kh·ªëi, l·ªõp, gi·ªõi t√≠nh, d√¢n t·ªôc, tr∆∞·ªùng.</p>

      <div class="dashboard-grid">
        <div class="stat-box">
          <h3>Th·ªëng k√™ ƒëƒÉng k√Ω / Registrations</h3>
          <div id="statTotal" class="stat-row">
            <span class="label">T·ªïng s·ªë ƒë√£ ƒëƒÉng k√Ω</span>
            <span class="value">‚Ä¶</span>
          </div>
          <div id="statKhoi" class="stat-row">
            <span class="label">Theo kh·ªëi (10/11/12)</span>
            <span class="value">‚Ä¶</span>
          </div>
          <div id="statGioiTinh" class="stat-row">
            <span class="label">Theo gi·ªõi t√≠nh</span>
            <span class="value">‚Ä¶</span>
          </div>
          <div id="statEthnic" class="stat-row">
            <span class="label">Theo d√¢n t·ªôc</span>
            <span class="value">‚Ä¶</span>
          </div>
          <div id="statSchool" class="stat-row">
            <span class="label">Theo tr∆∞·ªùng</span>
            <span class="value">‚Ä¶</span>
          </div>
        </div>

        <div class="chart-card">
          <h3>Bi·ªÉu ƒë·ªì ph√¢n b·ªë theo kh·ªëi / Grade distribution</h3>
          <p>Gi√∫p BGH n·∫Øm nhanh s·ªë l∆∞·ª£ng h·ªçc sinh ƒëƒÉng k√Ω theo t·ª´ng kh·ªëi l·ªõp.</p>
          <div class="chart-wrapper">
            <canvas id="chartKhoi"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- 6. TRA C·ª®U K·∫æT QU·∫¢ -->
    <section id="search" class="page">
      <h2 class="section-title">Tra c·ª©u k·∫øt qu·∫£ / Result lookup</h2>
      <p class="section-desc">Nh·∫≠p CCCD ho·∫∑c H·ªç t√™n + L·ªõp ƒë·ªÉ xem l·∫°i ƒëi·ªÉm t·ª´ sheet <b>DiemThi</b>.</p>

      <form id="searchForm">
        <div class="grid-2">
          <div class="field">
            <label for="search-cccd">CCCD</label>
            <input id="search-cccd" placeholder="∆Øu ti√™n tra c·ª©u theo CCCD" inputmode="numeric" />
          </div>
          <div class="field">
            <label for="search-name">H·ªç t√™n (IN HOA)</label>
            <input id="search-name" placeholder="VD: NGUY·ªÑN VƒÇN A" />
          </div>
          <div class="field">
            <label for="search-class">L·ªõp</label>
            <input id="search-class" placeholder="VD: 12A1" />
          </div>
        </div>

        <div class="btn-row">
          <button type="submit" class="btn-primary">
            <span class="icon">üîé</span><span>Tra c·ª©u k·∫øt qu·∫£</span>
          </button>
        </div>
      </form>
      <div id="status" class="status-msg status-empty"></div>
      <div id="results" class="results"></div>
    </section>
  </main>
</div>

<script>
  // üëâ NH·ªö C·∫¨P NH·∫¨T C√ôNG M·ªòT URL V·ªöI action C·ª¶A FORM
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxIRwnJhmX8lqY78QYpGiXXCYtWfCBrGVNZUoyJvhgJ0Ej6cYooLL-pVZPGJmOXKtY2/exec";

  function show(id, btn){
    document.querySelectorAll("section.page").forEach(sec=>{
      sec.classList.toggle("active", sec.id === id);
    });
    if(btn){
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
    }
  }

  function openExam(){
    const link = document.getElementById("examLink").value.trim();
    if(!link){ alert("Th·∫ßy/ch·ªã nh·∫≠p link Google Form/Quiz tr∆∞·ªõc ƒë√£ nh√©."); return; }
    window.open(link,"_blank");
  }
  function openSheet(){
    alert("M·ªü sheet CauHinhThi tr√™n Google Sheets (th·∫ßy c·∫•u h√¨nh link ri√™ng).");
  }

  // JSONP helper
  function callJsonp(url, cbName){
    return new Promise((resolve, reject)=>{
      const callbackName = "jsonp_cb_" + Date.now();
      window[callbackName] = function(data){
        resolve(data);
        delete window[callbackName];
        script.remove();
      };
      const script = document.createElement("script");
      script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + callbackName;
      script.onerror = reject;
      document.body.appendChild(script);
    });
  }

  // Dashboard
  async function loadDashboard(){
    try{
      const url = WEB_APP_URL + "?mode=stats";
      const data = await callJsonp(url,"statsCallback");
      if(!data) return;

      document.querySelector("#statTotal .value").textContent = data.total || 0;

      if(data.byKhoi){
        const entries = Object.entries(data.byKhoi);
        document.querySelector("#statKhoi .value").textContent =
          entries.map(([k,v])=>k+": "+v).join(" ¬∑ ") || "‚Äî";
        const ctx = document.getElementById("chartKhoi");
        if(ctx){
          new Chart(ctx,{
            type:"bar",
            data:{
              labels:entries.map(e=>e[0]),
              datasets:[{
                label:"S·ªë HS",
                data:entries.map(e=>e[1])
              }]
            },
            options:{
              plugins:{legend:{display:false}},
              scales:{
                x:{ticks:{font:{size:11}}},
                y:{beginAtZero:true,ticks:{stepSize:1}}
              }
            }
          });
        }
      }

      if(data.byGender){
        document.querySelector("#statGioiTinh .value").textContent =
          Object.entries(data.byGender).map(([k,v])=>k+": "+v).join(" ¬∑ ") || "‚Äî";
      }
      if(data.byEthnicity){
        document.querySelector("#statEthnic .value").textContent =
          Object.entries(data.byEthnicity).map(([k,v])=>k+": "+v).join(" ¬∑ ") || "‚Äî";
      }
      if(data.bySchool){
        document.querySelector("#statSchool .value").textContent =
          Object.entries(data.bySchool).map(([k,v])=>k+": "+v).join(" ¬∑ ") || "‚Äî";
      }
    }catch(err){
      console.error("L·ªói load Dashboard:",err);
    }
  }

  function buildSearchUrl(){
    const cccd = document.getElementById("search-cccd").value.trim();
    const name = document.getElementById("search-name").value.trim().toUpperCase();
    const className = document.getElementById("search-class").value.trim().toUpperCase();

    const params = new URLSearchParams();
    params.set("mode","search");
    if(cccd) params.set("cccd", cccd);
    if(name) params.set("name", name);
    if(className) params.set("className", className);

    return WEB_APP_URL + "?" + params.toString();
  }

  function renderSearchResults(data){
    const statusEl = document.getElementById("status");
    const resultsEl= document.getElementById("results");
    resultsEl.innerHTML="";
    if(!data){
      statusEl.textContent = "Kh√¥ng c√≥ d·ªØ li·ªáu tr·∫£ v·ªÅ.";
      statusEl.className = "status-msg status-error";
      return;
    }
    if(!data.found){
      statusEl.textContent = data.message || "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.";
      statusEl.className = "status-msg status-empty";
      return;
    }
    statusEl.textContent = data.message || "";
    statusEl.className = "status-msg";
    (data.results || []).forEach(row=>{
      const div = document.createElement("div");
      div.className = "result-card";
      div.innerHTML = `
        <h4>${row.name || ""} ‚Äì ${row.className || ""}</h4>
        <div class="result-meta">
          <span>ƒêi·ªÉm: <b>${row.score ?? ""}</b></span>
          <span>CCCD: ${row.cccd || "‚Äî"}</span>
          <span>Gi·ªõi t√≠nh: ${row.gender || "‚Äî"}</span>
          <span>D√¢n t·ªôc: ${row.ethnic || "‚Äî"}</span>
          <span>Tr∆∞·ªùng: ${row.school || "‚Äî"}</span>
        </div>
      `;
      resultsEl.appendChild(div);
    });
  }

  document.getElementById("searchForm").addEventListener("submit",async function(e){
    e.preventDefault();
    const statusEl = document.getElementById("status");
    const resultsEl= document.getElementById("results");
    resultsEl.innerHTML="";
    statusEl.textContent = "ƒêang tra c·ª©u, vui l√≤ng ch·ªù‚Ä¶";
    statusEl.className = "status-msg status-empty";

    try{
      const url = buildSearchUrl();
      const data = await callJsonp(url,"searchCallback");
      renderSearchResults(data);
    }catch(err){
      console.error(err);
      statusEl.textContent = "C√≥ l·ªói khi tra c·ª©u. Th·∫ßy/c√¥ ki·ªÉm tra l·∫°i Code.gs ho·∫∑c k·∫øt n·ªëi m·∫°ng.";
      statusEl.className = "status-msg status-error";
    }
  });

  // Kh·ªüi t·∫°o select Ng√†y sinh (Ng√†y-Th√°ng-NƒÉm) cho mobile
  function setupNgaySinh(){
    const daySel = document.getElementById("dob-day");
    const monthSel = document.getElementById("dob-month");
    const yearSel = document.getElementById("dob-year");
    const hidden = document.getElementById("ngaysinh");
    if(!daySel || !monthSel || !yearSel || !hidden) return;

    // T·∫°o option Ng√†y
    daySel.innerHTML = '<option value="">Ng√†y</option>';
    for(let d=1; d<=31; d++){
      const opt = document.createElement("option");
      opt.value = String(d).padStart(2,"0");
      opt.textContent = d;
      daySel.appendChild(opt);
    }

    // Th√°ng
    monthSel.innerHTML = '<option value="">Th√°ng</option>';
    for(let m=1; m<=12; m++){
      const opt = document.createElement("option");
      opt.value = String(m).padStart(2,"0");
      opt.textContent = m;
      monthSel.appendChild(opt);
    }

    // NƒÉm (1980‚Äì2015)
    yearSel.innerHTML = '<option value="">NƒÉm</option>';
    for(let y=2015; y>=1980; y--){
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = y;
      yearSel.appendChild(opt);
    }

    function syncDob(){
      const d = daySel.value;
      const m = monthSel.value;
      const y = yearSel.value;
      if(d && m && y){
        hidden.value = d + "/" + m + "/" + y;
      }else{
        hidden.value = "";
      }
    }

    daySel.addEventListener("change", syncDob);
    monthSel.addEventListener("change", syncDob);
    yearSel.addEventListener("change", syncDob);

    // Tr∆∞·ªõc khi submit form ƒëƒÉng k√Ω, ƒë·∫£m b·∫£o ƒë√£ sync
    const regForm = document.getElementById("regForm");
    if(regForm){
      regForm.addEventListener("submit", function(){
        syncDob();
      }, {capture:true});
    }
  }

  // T·∫£i Dashboard + kh·ªüi t·∫°o Date of Birth khi trang load
  // T·∫£i Dashboard ngay sau khi trang load (c√≥ s·∫µn d·ªØ li·ªáu cho tab Dashboard)
  document.addEventListener("DOMContentLoaded", function(){
    loadDashboard();
    setupNgaySinh();
  });
</script>
</body>
</html>
